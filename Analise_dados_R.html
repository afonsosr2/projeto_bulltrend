<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Análise de dados com R: utilizando o ChatGPT para aumentar a produtividade</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Analise_dados_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="Analise_dados_R_files/libs/quarto-html/quarto.js"></script>
<script src="Analise_dados_R_files/libs/quarto-html/popper.min.js"></script>
<script src="Analise_dados_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Analise_dados_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="Analise_dados_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Analise_dados_R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Analise_dados_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Analise_dados_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Analise_dados_R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Analise_dados_R_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="Analise_dados_R_files/libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="Analise_dados_R_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="Analise_dados_R_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="Analise_dados_R_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="Analise_dados_R_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="Analise_dados_R_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="Analise_dados_R_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análise de dados com R: utilizando o ChatGPT para aumentar a produtividade</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introdução" class="level2">
<h2 class="anchored" data-anchor-id="introdução">Introdução</h2>
<p><img src="images/Logo.png" class="img-fluid" width="720"></p>
<p>A consultoria financeira <strong>Bulltrend</strong> é uma empresa focada no suporte a clientes que investem no mercado financeiro, investigando as suas carteiras de investimento e analisando os ativos da bolsa brasileira (Ibovespa), pensando na melhor forma de indicar bons ativos e acompanhar a evolução destes.</p>
<p>Você, como analista de dados dessa consultoria, recebeu uma demanda do <em>Head de Dados</em> para extrair dados de uma série de ativos da bolsa brasileira e tratar esses dados para que sejam utilizados pelos consultores em softwares de BI. Esses dados consistem na seleção de vários indicadores para análise de desempenho das empresas presentes no <strong>Índice Ibovespa</strong>, bem como de outros valores importantes para análise.</p>
<p>Como grande parte dos analistas de dados desse setor da empresa utiliza a linguagem R, você terá que utilizar os conhecimentos que já possui em análise de dados para traduzir nesta linguagem conceitos que aprendeu em outras linguagens, como Python. E, para isso, utilizará o <strong>ChatGPT</strong> como um <strong>assistente pessoal</strong> para agilizar as análises e criar os códigos para extração, tratamento e visualização dos dados antes de entregar os dados consolidados para o time de consultoria da <strong>Bulltrend</strong>.</p>
<section id="problema-de-negócio" class="level4">
<h4 class="anchored" data-anchor-id="problema-de-negócio"><strong>Problema de negócio:</strong></h4>
<p>O objetivo da <strong>Bulltrend</strong> é utilizar esses dados para gerar dashboards, análises e dar suporte às demandas do time de consultoria. Para tal, é necessário combinar os dados passados em uma única tabela que seja fácil de manipular em qualquer ferramenta de BI ou análise de dados.</p>
</section>
<section id="base-de-dados" class="level4">
<h4 class="anchored" data-anchor-id="base-de-dados"><strong>Base de dados:</strong></h4>
<p>Vamos importar duas bases de dados em que:</p>
<ul>
<li><p>A primeira será um arquivo JSON chamado <code>dados_ativo_ibov.json</code> que possui todos os indicadores e valores importantes para consolidação em uma tabela final. Os dados estão atualizados até a data de <strong>07/11/2023</strong> com dados reais de empresas listadas na bolsa.</p></li>
<li><p>A segunda base de dados será um arquivo CSV chamado <code>Ativos_IBOV.csv</code> com a lista de todos os ativos que compõe o índice <a href="https://www.b3.com.br/pt_br/market-data-e-indices/indices/indices-amplos/indice-ibovespa-ibovespa-composicao-da-carteira.htm">IBOVESPA</a>. Será necessário, filtrar e retirar bancos e outras empresas financeiras que possuem indicadores mais específicos para análise.</p></li>
</ul>
</section>
<section id="desafio" class="level4">
<h4 class="anchored" data-anchor-id="desafio"><strong>Desafio:</strong></h4>
<p>Você, como analista de dados dessa consultoria, precisa extrair os dados dessas bases e tratá-los para que sejam utilizados pelos consultores em softwares de BI.</p>
</section>
</section>
<section id="instalando-os-pacotes-do-projeto" class="level2">
<h2 class="anchored" data-anchor-id="instalando-os-pacotes-do-projeto">Instalando os pacotes do projeto</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rodar código no console</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidyverse é um conjunto de pacotes que traz o ggplot2, dplyr, tidyr...</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># repos = "http://cran.us.r-project.org"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("tidyverse", "jsonlite", "plotly","openxlsx"), repos = repos)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="obtendo-os-dados-dos-ativos" class="level2">
<h2 class="anchored" data-anchor-id="obtendo-os-dados-dos-ativos">Obtendo os dados dos ativos</h2>
<p>Vamos iniciar o nosso processo de obtenção de arquivos extraindo os dados do arquivo <code>.json</code> que foi compartilhado conosco. Para agilizar todo o processo das nossas análises vamos pedir auxílio do ChatGPT. Neste notebook, vamos ser apresentados à prompts já testados dentro do fluxo que precisamos executar.</p>
<p>O nosso primeiro prompt diz:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código R que transforme o arquivo “dados_ativos_ibov.json” em uma lista chamada “dados” e leia o item de nome “ABEV3” dessa lista. Os dados vindos de “ABEV3” possuem n listas. Passe cada uma dessas listas para uma tabela e dê o nome de “tab_” seguida de sua ordem.</p>
</div>
</div>
<section id="código" class="level4">
<h4 class="anchored" data-anchor-id="código">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importando os pacotes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leia o arquivo JSON em uma lista</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"dados_ativos_ibov.json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Encontre os registros "ABEV3" na lista</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ticker <span class="ot">&lt;-</span> <span class="st">"ABEV3"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dados[[ticker]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
         X1                       X2              X3          X4
1    ?Papel                    ABEV3        ?Cotação       13,51
2     ?Tipo                       ON   ?Data últ cot  06/11/2023
3  ?Empresa             AMBEV S/A ON     ?Min 52 sem       12,29
4    ?Setor                  Bebidas     ?Max 52 sem       16,03
5 ?Subsetor Cervejas e Refrigerantes ?Vol $ méd (2m) 330.582.000

[[2]]
                 X1              X2                      X3             X4
1 ?Valor de mercado 212.834.000.000 ?Últ balanço processado     30/09/2023
2   ?Valor da firma 198.911.000.000             ?Nro. Ações 15.753.800.000

[[3]]
           X1         X2                           X3
1  Oscilações Oscilações Indicadores fundamentalistas
2         Dia      1,66%                         ?P/L
3         Mês      9,30%                        ?P/VP
4     30 dias      4,81%                      ?P/EBIT
5    12 meses    -14,22%                         ?PSR
6        2023     -6,96%                    ?P/Ativos
7        2022     -1,65%                 ?P/Cap. Giro
8        2021      2,39%             ?P/Ativ Circ Liq
9        2020    -14,20%                  ?Div. Yield
10       2019     24,08%                 ?EV / EBITDA
11       2018    -26,97%                   ?EV / EBIT
12                                    ?Cres. Rec (5a)
                             X4                           X5
1  Indicadores fundamentalistas Indicadores fundamentalistas
2                         14,11                         ?LPA
3                          2,36                         ?VPA
4                         12,52                 ?Marg. Bruta
5                          2,58                  ?Marg. EBIT
6                          1,54               ?Marg. Líquida
7                         57,42                ?EBIT / Ativo
8                        -24,18                        ?ROIC
9                          5,6%                         ?ROE
10                         8,61               ?Liquidez Corr
11                        11,70              ?Div Br/ Patrim
12                        13,2%                 ?Giro Ativos
                             X6
1  Indicadores fundamentalistas
2                          0,96
3                          5,73
4                         50,3%
5                         20,6%
6                         18,8%
7                         12,3%
8                         16,5%
9                         16,7%
10                         1,11
11                         0,04
12                         0,60

[[4]]
                         X1                        X2                        X3
1 Dados Balanço Patrimonial Dados Balanço Patrimonial Dados Balanço Patrimonial
2                    ?Ativo           137.914.000.000               ?Dív. Bruta
3         ?Disponibilidades            17.641.100.000             ?Dív. Líquida
4         ?Ativo Circulante            37.552.700.000              ?Patrim. Líq
                         X4
1 Dados Balanço Patrimonial
2             3.717.670.000
3           -13.923.400.000
4            90.254.900.000

[[5]]
                                  X1                                 X2
1 Dados demonstrativos de resultados Dados demonstrativos de resultados
2                   Últimos 12 meses                   Últimos 12 meses
3                   ?Receita Líquida                     82.440.700.000
4                              ?EBIT                     17.003.900.000
5                     ?Lucro Líquido                     15.081.200.000
                                  X3                                 X4
1 Dados demonstrativos de resultados Dados demonstrativos de resultados
2                    Últimos 3 meses                    Últimos 3 meses
3                   ?Receita Líquida                     20.317.800.000
4                              ?EBIT                      4.438.050.000
5                     ?Lucro Líquido                      3.911.740.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(dados[[ticker]])) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  tabela_nome <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"tab_"</span>, i, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(tabela_nome, <span class="fu">as.data.frame</span>(dados[[ticker]][[i]]))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tabela-1-tab_1" class="level3">
<h3 class="anchored" data-anchor-id="tabela-1-tab_1">Tabela 1 (tab_1)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tab_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         X1                       X2              X3          X4
1    ?Papel                    ABEV3        ?Cotação       13,51
2     ?Tipo                       ON   ?Data últ cot  06/11/2023
3  ?Empresa             AMBEV S/A ON     ?Min 52 sem       12,29
4    ?Setor                  Bebidas     ?Max 52 sem       16,03
5 ?Subsetor Cervejas e Refrigerantes ?Vol $ méd (2m) 330.582.000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que crie o data.frame “df_1” com as colunas “tipo” e “valor”. A coluna “tipo” recebe a coluna “X1” de “tab_1” e a coluna “valor” recebe a coluna “X2” do mesmo “tab_1”. Em seguida, selecione as linhas do data.frame por indice com apenas a 1ª, 4ª e 5ª linhas.</p>
</div>
</div>
<section id="código-1" class="level4">
<h4 class="anchored" data-anchor-id="código-1">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data frame a partir de "tab_1", renomeando as colunas</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> tab_1 <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">tipo =</span> X1, <span class="at">valor =</span> X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecione as linhas do data frame por índice</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> df_1[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       tipo                    valor
1    ?Papel                    ABEV3
4    ?Setor                  Bebidas
5 ?Subsetor Cervejas e Refrigerantes</code></pre>
</div>
</div>
<p>Note que precisamos ajustar a coluna “tipo” retirando o símbolo “?”.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R para retirar o primeiro caracter dos valores da coluna “tipo” do data.frame “df_1” usando regex. Além disso, renomeie o registro “Papel” da coluna “tipo” do “df_1” para “Ação”.</p>
</div>
</div>
</section>
<section id="código-2" class="level4">
<h4 class="anchored" data-anchor-id="código-2">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_1<span class="sc">$</span>tipo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomeia o registro "Papel" para "Ação" na coluna "tipo"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>tipo[df_1<span class="sc">$</span>tipo <span class="sc">==</span> <span class="st">"Papel"</span>] <span class="ot">&lt;-</span> <span class="st">"Ação"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      tipo                    valor
1     Ação                    ABEV3
4    Setor                  Bebidas
5 Subsetor Cervejas e Refrigerantes</code></pre>
</div>
</div>
<p>Pronto! Já tratamos a 1ª tabela da nossa base de dados. Agora vamos prosseguir para a 2ª com os dados de Valor de Mercado, número de ações entre outros.</p>
</section>
</section>
<section id="tabela-2-tab_2" class="level3">
<h3 class="anchored" data-anchor-id="tabela-2-tab_2">Tabela 2 (tab_2)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tab_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 X1              X2                      X3             X4
1 ?Valor de mercado 212.834.000.000 ?Últ balanço processado     30/09/2023
2   ?Valor da firma 198.911.000.000             ?Nro. Ações 15.753.800.000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que crie o data.frame “df_2” com as colunas “tipo” e “valor”. A coluna “tipo” recebe um vetor que seleciona as colunas “X1” e “X3” de “tab_2” e a coluna “valor” recebe um vetor que seleciona as colunas “X2” e “X4” do mesmo “tab_2”.</p>
</div>
</div>
<section id="código-3" class="level4">
<h4 class="anchored" data-anchor-id="código-3">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data.frame df_2</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo =</span> <span class="fu">c</span>(tab_2<span class="sc">$</span>X1, tab_2<span class="sc">$</span>X3), <span class="co"># Seleciona as colunas X1 e X3</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(tab_2<span class="sc">$</span>X2, tab_2<span class="sc">$</span>X4)  <span class="co"># Seleciona as colunas X2 e X4</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     tipo           valor
1       ?Valor de mercado 212.834.000.000
2         ?Valor da firma 198.911.000.000
3 ?Últ balanço processado      30/09/2023
4             ?Nro. Ações  15.753.800.000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Elimine a 3ª linha do data.frame “df_2” usando filter() e remova o primeiro caracter dos valores da coluna “tipo” do data.frame “df_2” usando regex.</p>
</div>
</div>
</section>
<section id="código-4" class="level4">
<h4 class="anchored" data-anchor-id="código-4">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Elimine a 3ª linha de df_2 usando filter()</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> df_2 <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remova o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df_2<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_2<span class="sc">$</span>tipo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              tipo           valor
1 Valor de mercado 212.834.000.000
2   Valor da firma 198.911.000.000
3       Nro. Ações  15.753.800.000</code></pre>
</div>
</div>
<p>Nossa 2ª tabela já foi extraída com sucesso utilizando o apoio do ChatGPT. Agora, vamos para a tabela de indicadores, que será a nossa tabela com maior número de observações a obter.</p>
</section>
</section>
<section id="tabela-3-tab_3" class="level3">
<h3 class="anchored" data-anchor-id="tabela-3-tab_3">Tabela 3 (tab_3)</h3>
<p>Antes de chamarmos o novo prompt, vamos ler o <strong>tab_3</strong> e selecionar apenas as colunas de interesse como aprendemos no 1º prompt da <strong>tab_2.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tab_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           X1         X2                           X3
1  Oscilações Oscilações Indicadores fundamentalistas
2         Dia      1,66%                         ?P/L
3         Mês      9,30%                        ?P/VP
4     30 dias      4,81%                      ?P/EBIT
5    12 meses    -14,22%                         ?PSR
6        2023     -6,96%                    ?P/Ativos
7        2022     -1,65%                 ?P/Cap. Giro
8        2021      2,39%             ?P/Ativ Circ Liq
9        2020    -14,20%                  ?Div. Yield
10       2019     24,08%                 ?EV / EBITDA
11       2018    -26,97%                   ?EV / EBIT
12                                    ?Cres. Rec (5a)
                             X4                           X5
1  Indicadores fundamentalistas Indicadores fundamentalistas
2                         14,11                         ?LPA
3                          2,36                         ?VPA
4                         12,52                 ?Marg. Bruta
5                          2,58                  ?Marg. EBIT
6                          1,54               ?Marg. Líquida
7                         57,42                ?EBIT / Ativo
8                        -24,18                        ?ROIC
9                          5,6%                         ?ROE
10                         8,61               ?Liquidez Corr
11                        11,70              ?Div Br/ Patrim
12                        13,2%                 ?Giro Ativos
                             X6
1  Indicadores fundamentalistas
2                          0,96
3                          5,73
4                         50,3%
5                         20,6%
6                         18,8%
7                         12,3%
8                         16,5%
9                         16,7%
10                         1,11
11                         0,04
12                         0,60</code></pre>
</div>
</div>
<p>Aqui vamos, retirar as colunas com os dados de oscilações que não seram necessárias em nossas análises. (<code>X1</code> e <code>X2</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data frame "df_3" a partir de "tab_3" agrupando as colunas</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df_3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_3<span class="sc">$</span>X3, tab_3<span class="sc">$</span>X5), </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">valor =</span> <span class="fu">c</span>(tab_3<span class="sc">$</span>X4, tab_3<span class="sc">$</span>X6))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           tipo                        valor
1  Indicadores fundamentalistas Indicadores fundamentalistas
2                          ?P/L                        14,11
3                         ?P/VP                         2,36
4                       ?P/EBIT                        12,52
5                          ?PSR                         2,58
6                     ?P/Ativos                         1,54
7                  ?P/Cap. Giro                        57,42
8              ?P/Ativ Circ Liq                       -24,18
9                   ?Div. Yield                         5,6%
10                 ?EV / EBITDA                         8,61
11                   ?EV / EBIT                        11,70
12              ?Cres. Rec (5a)                        13,2%
13 Indicadores fundamentalistas Indicadores fundamentalistas
14                         ?LPA                         0,96
15                         ?VPA                         5,73
16                 ?Marg. Bruta                        50,3%
17                  ?Marg. EBIT                        20,6%
18               ?Marg. Líquida                        18,8%
19                ?EBIT / Ativo                        12,3%
20                        ?ROIC                        16,5%
21                         ?ROE                        16,7%
22               ?Liquidez Corr                         1,11
23              ?Div Br/ Patrim                         0,04
24                 ?Giro Ativos                         0,60</code></pre>
</div>
</div>
<p>Precisamos eliminar as linhas em que temos apenas a frase “Indicadores fundamentalistas”. Para isso, vamos pedir o suporte novamente ao chatGPT. Esta frase está nas linhas 1 e 13 de nossos dados.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere o código que exclua as linhas 1 e 13 do data.frame “df_3” com filter() e que retire o primeiro caractere dos valores da coluna “tipo” do mesmo dataframe usando regex.</p>
</div>
</div>
<section id="código-5" class="level4">
<h4 class="anchored" data-anchor-id="código-5">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclua as linhas 1 e 13 do data frame</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_3 <span class="ot">&lt;-</span> df_3 <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remova o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_3<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_3<span class="sc">$</span>tipo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              tipo  valor
1              P/L  14,11
2             P/VP   2,36
3           P/EBIT  12,52
4              PSR   2,58
5         P/Ativos   1,54
6      P/Cap. Giro  57,42
7  P/Ativ Circ Liq -24,18
8       Div. Yield   5,6%
9      EV / EBITDA   8,61
10       EV / EBIT  11,70
11  Cres. Rec (5a)  13,2%
12             LPA   0,96
13             VPA   5,73
14     Marg. Bruta  50,3%
15      Marg. EBIT  20,6%
16   Marg. Líquida  18,8%
17    EBIT / Ativo  12,3%
18            ROIC  16,5%
19             ROE  16,7%
20   Liquidez Corr   1,11
21  Div Br/ Patrim   0,04
22     Giro Ativos   0,60</code></pre>
</div>
</div>
<p>Finalizamos o tratamento de mais uma tabela. Vamos prosseguir para a tabela com os dados do balanço patrimonial da empresa.</p>
</section>
</section>
<section id="tabela-4-tab_4" class="level3">
<h3 class="anchored" data-anchor-id="tabela-4-tab_4">Tabela 4 (tab_4)</h3>
<p>Nesta nova tabela vamos aplicar as ideias que já exploramos nas últimas tabelas que tratamos. Aqui não utilizaremos o chatGPT, pois o processo é similar para este caso. Vamos ler a <strong>tab_4?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>tab_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         X1                        X2                        X3
1 Dados Balanço Patrimonial Dados Balanço Patrimonial Dados Balanço Patrimonial
2                    ?Ativo           137.914.000.000               ?Dív. Bruta
3         ?Disponibilidades            17.641.100.000             ?Dív. Líquida
4         ?Ativo Circulante            37.552.700.000              ?Patrim. Líq
                         X4
1 Dados Balanço Patrimonial
2             3.717.670.000
3           -13.923.400.000
4            90.254.900.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data frame "df_4" a partir de "tab_4" agrupando as colunas</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_4<span class="sc">$</span>X1, tab_4<span class="sc">$</span>X3), </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">valor =</span> <span class="fu">c</span>(tab_4<span class="sc">$</span>X2, tab_4<span class="sc">$</span>X4))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>df_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       tipo                     valor
1 Dados Balanço Patrimonial Dados Balanço Patrimonial
2                    ?Ativo           137.914.000.000
3         ?Disponibilidades            17.641.100.000
4         ?Ativo Circulante            37.552.700.000
5 Dados Balanço Patrimonial Dados Balanço Patrimonial
6               ?Dív. Bruta             3.717.670.000
7             ?Dív. Líquida           -13.923.400.000
8              ?Patrim. Líq            90.254.900.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_4 <span class="ot">&lt;-</span> df_4 <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_4<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_4<span class="sc">$</span>tipo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              tipo           valor
1            Ativo 137.914.000.000
2 Disponibilidades  17.641.100.000
3 Ativo Circulante  37.552.700.000
4       Dív. Bruta   3.717.670.000
5     Dív. Líquida -13.923.400.000
6      Patrim. Líq  90.254.900.000</code></pre>
</div>
</div>
<p>Tratamos a 4ª tabela gerando mais um df com os dados a serem analisados. Vamos partir para a última tabela com os dados demonstrativos de resultados.</p>
</section>
<section id="tabela-5-tab_5" class="level3">
<h3 class="anchored" data-anchor-id="tabela-5-tab_5">Tabela 5 (tab_5)</h3>
<p>Na nossa última tabela iniciaremos fazendo alguns processos semelhantes a <strong>tab_4</strong>. Vamos ler a <strong>tab_5?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>tab_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  X1                                 X2
1 Dados demonstrativos de resultados Dados demonstrativos de resultados
2                   Últimos 12 meses                   Últimos 12 meses
3                   ?Receita Líquida                     82.440.700.000
4                              ?EBIT                     17.003.900.000
5                     ?Lucro Líquido                     15.081.200.000
                                  X3                                 X4
1 Dados demonstrativos de resultados Dados demonstrativos de resultados
2                    Últimos 3 meses                    Últimos 3 meses
3                   ?Receita Líquida                     20.317.800.000
4                              ?EBIT                      4.438.050.000
5                     ?Lucro Líquido                      3.911.740.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data frame "df_5" a partir de "tab_5" agrupando as colunas</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_5<span class="sc">$</span>X1, tab_5<span class="sc">$</span>X3), </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">valor =</span> <span class="fu">c</span>(tab_5<span class="sc">$</span>X2, tab_5<span class="sc">$</span>X4))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>df_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                 tipo                              valor
1  Dados demonstrativos de resultados Dados demonstrativos de resultados
2                    Últimos 12 meses                   Últimos 12 meses
3                    ?Receita Líquida                     82.440.700.000
4                               ?EBIT                     17.003.900.000
5                      ?Lucro Líquido                     15.081.200.000
6  Dados demonstrativos de resultados Dados demonstrativos de resultados
7                     Últimos 3 meses                    Últimos 3 meses
8                    ?Receita Líquida                     20.317.800.000
9                               ?EBIT                      4.438.050.000
10                     ?Lucro Líquido                      3.911.740.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclua as linhas 1, 2, 6 e 7 do data frame</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_5 <span class="ot">&lt;-</span> df_5 <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_5<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_5<span class="sc">$</span>tipo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             tipo          valor
1 Receita Líquida 82.440.700.000
2            EBIT 17.003.900.000
3   Lucro Líquido 15.081.200.000
4 Receita Líquida 20.317.800.000
5            EBIT  4.438.050.000
6   Lucro Líquido  3.911.740.000</code></pre>
</div>
</div>
<p><strong><em>Você notou algum problema nesta tabela?</em></strong></p>
<p>Sim, temos cada coluna sendo repetida duas vezes, isto porque as três primeiras rementem aos valores para os <strong>últimos 12 meses</strong> e as três últimas para os <strong>últimos 3 meses</strong>. Aqui, então, vamos pedir auxílio para o ChatGPT para renomear os dados na coluna tipo.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere o código em R que concatene o valor “_ult_12_meses” nos primeiros 3 valores da coluna “tipo” do dataframe “df_5” e “_ult_3_meses” nos 3 últimos valores da coluna “tipo”.</p>
</div>
</div>
<section id="código-6" class="level4">
<h4 class="anchored" data-anchor-id="código-6">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar "_ult_12_meses" nos primeiros 3 valores da coluna "tipo"</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_5<span class="sc">$</span>tipo[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df_5<span class="sc">$</span>tipo[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">"_ult_12_meses"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenar "_ult_3_meses" nos últimos 3 valores da coluna "tipo"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>df_5<span class="sc">$</span>tipo[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(df_5<span class="sc">$</span>tipo[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>], <span class="st">"_ult_3_meses"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          tipo          valor
1 Receita Líquida_ult_12_meses 82.440.700.000
2            EBIT_ult_12_meses 17.003.900.000
3   Lucro Líquido_ult_12_meses 15.081.200.000
4  Receita Líquida_ult_3_meses 20.317.800.000
5             EBIT_ult_3_meses  4.438.050.000
6    Lucro Líquido_ult_3_meses  3.911.740.000</code></pre>
</div>
</div>
<p>Agora sim! Temos todas as 5 tabelas tratadas. Vamos então seguir para agrupá-las em uma só, mudando também a sua estrutura para que o time de consultoria possa utilizá-la em softwares de BI e/ou análise de dados.</p>
</section>
</section>
</section>
<section id="agrupando-as-tabelas" class="level2">
<h2 class="anchored" data-anchor-id="agrupando-as-tabelas">Agrupando as tabelas</h2>
<p>Vamos pedir mais um auxílio aqui ao ChatGPT desta vez para consolidar as tabelas em uma só. Note que intencionalmente usamos o mesmo padrão “tipo” para o tipo do dado e “valor” para o valor do dado que extraímos.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere o código em R que agrupe as 5 tabelas tratadas (df_1, .., df_5) uma embaixo da outra pelas colunas “tipo” e “valor”.</p>
</div>
</div>
<section id="código-7" class="level4">
<h4 class="anchored" data-anchor-id="código-7">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine os data.frames df_1, df_2, df_3, df_4 e df_5 em um único data.frame</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_1, df_2, df_3, df_4, df_5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">tipo</th>
<th style="text-align: left;">valor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Ação</td>
<td style="text-align: left;">ABEV3</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Setor</td>
<td style="text-align: left;">Bebidas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Subsetor</td>
<td style="text-align: left;">Cervejas e Refrigerantes</td>
</tr>
<tr class="even">
<td style="text-align: left;">110</td>
<td style="text-align: left;">Valor de mercado</td>
<td style="text-align: left;">212.834.000.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Valor da firma</td>
<td style="text-align: left;">198.911.000.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Nro. Ações</td>
<td style="text-align: left;">15.753.800.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">111</td>
<td style="text-align: left;">P/L</td>
<td style="text-align: left;">14,11</td>
</tr>
<tr class="even">
<td style="text-align: left;">23</td>
<td style="text-align: left;">P/VP</td>
<td style="text-align: left;">2,36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">31</td>
<td style="text-align: left;">P/EBIT</td>
<td style="text-align: left;">12,52</td>
</tr>
<tr class="even">
<td style="text-align: left;">41</td>
<td style="text-align: left;">PSR</td>
<td style="text-align: left;">2,58</td>
</tr>
<tr class="odd">
<td style="text-align: left;">51</td>
<td style="text-align: left;">P/Ativos</td>
<td style="text-align: left;">1,54</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">P/Cap. Giro</td>
<td style="text-align: left;">57,42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">P/Ativ Circ Liq</td>
<td style="text-align: left;">-24,18</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">Div. Yield</td>
<td style="text-align: left;">5,6%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">EV / EBITDA</td>
<td style="text-align: left;">8,61</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">EV / EBIT</td>
<td style="text-align: left;">11,70</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: left;">Cres. Rec (5a)</td>
<td style="text-align: left;">13,2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: left;">LPA</td>
<td style="text-align: left;">0,96</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: left;">VPA</td>
<td style="text-align: left;">5,73</td>
</tr>
<tr class="even">
<td style="text-align: left;">14</td>
<td style="text-align: left;">Marg. Bruta</td>
<td style="text-align: left;">50,3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">Marg. EBIT</td>
<td style="text-align: left;">20,6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: left;">Marg. Líquida</td>
<td style="text-align: left;">18,8%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17</td>
<td style="text-align: left;">EBIT / Ativo</td>
<td style="text-align: left;">12,3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">18</td>
<td style="text-align: left;">ROIC</td>
<td style="text-align: left;">16,5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">19</td>
<td style="text-align: left;">ROE</td>
<td style="text-align: left;">16,7%</td>
</tr>
<tr class="even">
<td style="text-align: left;">20</td>
<td style="text-align: left;">Liquidez Corr</td>
<td style="text-align: left;">1,11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">21</td>
<td style="text-align: left;">Div Br/ Patrim</td>
<td style="text-align: left;">0,04</td>
</tr>
<tr class="even">
<td style="text-align: left;">22</td>
<td style="text-align: left;">Giro Ativos</td>
<td style="text-align: left;">0,60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Ativo</td>
<td style="text-align: left;">137.914.000.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">24</td>
<td style="text-align: left;">Disponibilidades</td>
<td style="text-align: left;">17.641.100.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">32</td>
<td style="text-align: left;">Ativo Circulante</td>
<td style="text-align: left;">37.552.700.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">42</td>
<td style="text-align: left;">Dív. Bruta</td>
<td style="text-align: left;">3.717.670.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">52</td>
<td style="text-align: left;">Dív. Líquida</td>
<td style="text-align: left;">-13.923.400.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">61</td>
<td style="text-align: left;">Patrim. Líq</td>
<td style="text-align: left;">90.254.900.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">113</td>
<td style="text-align: left;">Receita Líquida_ult_12_meses</td>
<td style="text-align: left;">82.440.700.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">25</td>
<td style="text-align: left;">EBIT_ult_12_meses</td>
<td style="text-align: left;">17.003.900.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">33</td>
<td style="text-align: left;">Lucro Líquido_ult_12_meses</td>
<td style="text-align: left;">15.081.200.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">43</td>
<td style="text-align: left;">Receita Líquida_ult_3_meses</td>
<td style="text-align: left;">20.317.800.000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">53</td>
<td style="text-align: left;">EBIT_ult_3_meses</td>
<td style="text-align: left;">4.438.050.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">62</td>
<td style="text-align: left;">Lucro Líquido_ult_3_meses</td>
<td style="text-align: left;">3.911.740.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Mas esta não é a forma que queremos apresentar os dados, principalmente pelo fato de que esta tabela apresenta apenas um ativo.</p>
</section>
</section>
<section id="alterando-a-estrutura-da-tabela-consolidada" class="level2">
<h2 class="anchored" data-anchor-id="alterando-a-estrutura-da-tabela-consolidada">Alterando a estrutura da tabela consolidada</h2>
<p>Para isso, vamos transformar essa tabela do formato longo (<strong>long</strong>) para amplo (<strong>wide</strong>). Ou seja, ao invés de muitas linhas teremos muitas colunas, cada uma com um tipo de dado.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere o código que altere a estrutura de long para wide do data.frame “dados” que possui 2 colunas: a coluna “tipo” com os indicadores e a “valor” com os valores de cada indicador. Construa um novo data.frame que esses indicadores sejam as colunas e os valores os registros do data.frame.</p>
</div>
</div>
<section id="código-8" class="level4">
<h4 class="anchored" data-anchor-id="código-8">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforme a estrutura de long para wide</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dados_wide <span class="ot">&lt;-</span> <span class="fu">spread</span>(dados, <span class="at">key =</span> tipo, <span class="at">value =</span> valor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(dados_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dados_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 0%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 0%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 0%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ação</th>
<th style="text-align: left;">Ativo</th>
<th style="text-align: left;">Ativo Circulante</th>
<th style="text-align: left;">Cres. Rec (5a)</th>
<th style="text-align: left;">Disponibilidades</th>
<th style="text-align: left;">Div Br/ Patrim</th>
<th style="text-align: left;">Dív. Bruta</th>
<th style="text-align: left;">Dív. Líquida</th>
<th style="text-align: left;">Div. Yield</th>
<th style="text-align: left;">EBIT / Ativo</th>
<th style="text-align: left;">EBIT_ult_12_meses</th>
<th style="text-align: left;">EBIT_ult_3_meses</th>
<th style="text-align: left;">EV / EBIT</th>
<th style="text-align: left;">EV / EBITDA</th>
<th style="text-align: left;">Giro Ativos</th>
<th style="text-align: left;">Liquidez Corr</th>
<th style="text-align: left;">LPA</th>
<th style="text-align: left;">Lucro Líquido_ult_12_meses</th>
<th style="text-align: left;">Lucro Líquido_ult_3_meses</th>
<th style="text-align: left;">Marg. Bruta</th>
<th style="text-align: left;">Marg. EBIT</th>
<th style="text-align: left;">Marg. Líquida</th>
<th style="text-align: left;">Nro. Ações</th>
<th style="text-align: left;">P/Ativ Circ Liq</th>
<th style="text-align: left;">P/Ativos</th>
<th style="text-align: left;">P/Cap. Giro</th>
<th style="text-align: left;">P/EBIT</th>
<th style="text-align: left;">P/L</th>
<th style="text-align: left;">P/VP</th>
<th style="text-align: left;">Patrim. Líq</th>
<th style="text-align: left;">PSR</th>
<th style="text-align: left;">Receita Líquida_ult_12_meses</th>
<th style="text-align: left;">Receita Líquida_ult_3_meses</th>
<th style="text-align: left;">ROE</th>
<th style="text-align: left;">ROIC</th>
<th style="text-align: left;">Setor</th>
<th style="text-align: left;">Subsetor</th>
<th style="text-align: left;">Valor da firma</th>
<th style="text-align: left;">Valor de mercado</th>
<th style="text-align: left;">VPA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ABEV3</td>
<td style="text-align: left;">137.914.000.000</td>
<td style="text-align: left;">37.552.700.000</td>
<td style="text-align: left;">13,2%</td>
<td style="text-align: left;">17.641.100.000</td>
<td style="text-align: left;">0,04</td>
<td style="text-align: left;">3.717.670.000</td>
<td style="text-align: left;">-13.923.400.000</td>
<td style="text-align: left;">5,6%</td>
<td style="text-align: left;">12,3%</td>
<td style="text-align: left;">17.003.900.000</td>
<td style="text-align: left;">4.438.050.000</td>
<td style="text-align: left;">11,70</td>
<td style="text-align: left;">8,61</td>
<td style="text-align: left;">0,60</td>
<td style="text-align: left;">1,11</td>
<td style="text-align: left;">0,96</td>
<td style="text-align: left;">15.081.200.000</td>
<td style="text-align: left;">3.911.740.000</td>
<td style="text-align: left;">50,3%</td>
<td style="text-align: left;">20,6%</td>
<td style="text-align: left;">18,8%</td>
<td style="text-align: left;">15.753.800.000</td>
<td style="text-align: left;">-24,18</td>
<td style="text-align: left;">1,54</td>
<td style="text-align: left;">57,42</td>
<td style="text-align: left;">12,52</td>
<td style="text-align: left;">14,11</td>
<td style="text-align: left;">2,36</td>
<td style="text-align: left;">90.254.900.000</td>
<td style="text-align: left;">2,58</td>
<td style="text-align: left;">82.440.700.000</td>
<td style="text-align: left;">20.317.800.000</td>
<td style="text-align: left;">16,7%</td>
<td style="text-align: left;">16,5%</td>
<td style="text-align: left;">Bebidas</td>
<td style="text-align: left;">Cervejas e Refrigerantes</td>
<td style="text-align: left;">198.911.000.000</td>
<td style="text-align: left;">212.834.000.000</td>
<td style="text-align: left;">5,73</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="importando-mais-ativos" class="level2">
<h2 class="anchored" data-anchor-id="importando-mais-ativos">Importando mais ativos</h2>
<p>Nesta etapa, vamos trazer 3 ações para conseguir replicar todo o processo que fizemos anteriormente para um número <code>n</code> de ações desejadas. São elas</p>
<ol type="1">
<li>Gerar uma função que extraia os dados e trata as tabelas (compilando os processos)</li>
<li>Selecionar quais ativos vamos extrair pelo <code>Ativos_IBOV.csv</code></li>
<li>Extrair os dados dos ativos selecionados.</li>
</ol>
<section id="função-indicadores" class="level3">
<h3 class="anchored" data-anchor-id="função-indicadores">1. Função <code>indicadores</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A função é adequada para uma série de empresas exceto bancos que possuem</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># diferentes indicadores dos quais iremos analisar.</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>indicadores <span class="ot">&lt;-</span> <span class="cf">function</span>(ticker){</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Leia o arquivo JSON em uma lista</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  dados <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"dados_ativos_ibov.json"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie tabelas a partir das listas e nomeie-as com "tab_" + ordem</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dados[[ticker]])) {</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    table_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"tab_"</span>, i)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    table_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dados[[ticker]][[i]])</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(table_name, table_data)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabela 1</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie o data frame a partir de "tab_1", renomeando as colunas</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  df_1 <span class="ot">&lt;-</span> tab_1 <span class="sc">%&gt;%</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">tipo =</span> X1, <span class="at">valor =</span> X2)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Selecione as linhas do data frame por índice</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  df_1 <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>  df_1<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_1<span class="sc">$</span>tipo)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renomeia o registro "Papel" para "Ação" na coluna "tipo"</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  df_1<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Papel"</span>, <span class="st">"Ação"</span>, df_1<span class="sc">$</span>tipo)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabela 2</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie o data.frame df_2</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  df_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">tipo =</span> <span class="fu">c</span>(tab_2<span class="sc">$</span>X1, tab_2<span class="sc">$</span>X3), <span class="co"># Seleciona as colunas X1 e X3</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">valor =</span> <span class="fu">c</span>(tab_2<span class="sc">$</span>X2, tab_2<span class="sc">$</span>X4)  <span class="co"># Seleciona as colunas X2 e X4</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Elimine a 3ª linha de df_2 usando filter()</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>  df_2 <span class="ot">&lt;-</span> df_2 <span class="sc">%&gt;%</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">3</span>)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remova o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>  df_2<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_2<span class="sc">$</span>tipo)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabela 3</span></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie o data frame "df_3" a partir de "tab_3" agrupando as colunas</span></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>  df_3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_3<span class="sc">$</span>X3, tab_3<span class="sc">$</span>X5), </span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>                    <span class="at">valor =</span> <span class="fu">c</span>(tab_3<span class="sc">$</span>X4, tab_3<span class="sc">$</span>X6))  </span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclua as linhas 1 e 13 do data frame</span></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>  df_3 <span class="ot">&lt;-</span> df_3 <span class="sc">%&gt;%</span></span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remova o primeiro caractere dos valores da coluna "tipo" usando regex</span></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>  df_3<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_3<span class="sc">$</span>tipo)</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabela 4</span></span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie o data frame "df_4" a partir de "tab_4" agrupando as colunas</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>  df_4 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_4<span class="sc">$</span>X1, tab_4<span class="sc">$</span>X3), </span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">valor =</span> <span class="fu">c</span>(tab_4<span class="sc">$</span>X2, tab_4<span class="sc">$</span>X4))</span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>  df_4 <span class="ot">&lt;-</span> df_4 <span class="sc">%&gt;%</span> </span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a>  df_4<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_4<span class="sc">$</span>tipo)</span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tabela 5</span></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crie o data frame "df_5" a partir de "tab_5" agrupando as colunas</span></span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>  df_5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tipo =</span> <span class="fu">c</span>(tab_5<span class="sc">$</span>X1, tab_5<span class="sc">$</span>X3), </span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>                     <span class="at">valor =</span> <span class="fu">c</span>(tab_5<span class="sc">$</span>X2, tab_5<span class="sc">$</span>X4))</span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclua as linhas 1, 2, 6 e 7 do data frame</span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>  df_5 <span class="ot">&lt;-</span> df_5 <span class="sc">%&gt;%</span></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">7</span>))</span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a>  df_5<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^."</span>, <span class="st">""</span>, df_5<span class="sc">$</span>tipo)</span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Concatene os sufixos nos valores da coluna "tipo" em df_5</span></span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>  df_5<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(df_5<span class="sc">$</span>tipo[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">"_ult_12_meses"</span>), </span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(df_5<span class="sc">$</span>tipo[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>], <span class="st">"_ult_3_meses"</span>))</span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Agrupando as tabelas</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a>  dados <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_1, df_2, df_3, df_4, df_5)</span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a>  dados</span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Alterando a estrutura da tabela</span></span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transforme a estrutura de long para wide</span></span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a>  dados_wide <span class="ot">&lt;-</span> <span class="fu">spread</span>(dados, <span class="at">key =</span> tipo, <span class="at">value =</span> valor)</span>
<span id="cb59-98"><a href="#cb59-98" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="testando-a-função" class="level4">
<h4 class="anchored" data-anchor-id="testando-a-função">Testando a função</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testando a execução da função por meio de um ativo</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>vale <span class="ot">&lt;-</span> <span class="fu">indicadores</span>(<span class="st">"VALE3"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(vale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 0%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ação</th>
<th style="text-align: left;">Ativo</th>
<th style="text-align: left;">Ativo Circulante</th>
<th style="text-align: left;">Cres. Rec (5a)</th>
<th style="text-align: left;">Disponibilidades</th>
<th style="text-align: left;">Div Br/ Patrim</th>
<th style="text-align: left;">Dív. Bruta</th>
<th style="text-align: left;">Dív. Líquida</th>
<th style="text-align: left;">Div. Yield</th>
<th style="text-align: left;">EBIT / Ativo</th>
<th style="text-align: left;">EBIT_ult_12_meses</th>
<th style="text-align: left;">EBIT_ult_3_meses</th>
<th style="text-align: left;">EV / EBIT</th>
<th style="text-align: left;">EV / EBITDA</th>
<th style="text-align: left;">Giro Ativos</th>
<th style="text-align: left;">Liquidez Corr</th>
<th style="text-align: left;">LPA</th>
<th style="text-align: left;">Lucro Líquido_ult_12_meses</th>
<th style="text-align: left;">Lucro Líquido_ult_3_meses</th>
<th style="text-align: left;">Marg. Bruta</th>
<th style="text-align: left;">Marg. EBIT</th>
<th style="text-align: left;">Marg. Líquida</th>
<th style="text-align: left;">Nro. Ações</th>
<th style="text-align: left;">P/Ativ Circ Liq</th>
<th style="text-align: left;">P/Ativos</th>
<th style="text-align: left;">P/Cap. Giro</th>
<th style="text-align: left;">P/EBIT</th>
<th style="text-align: left;">P/L</th>
<th style="text-align: left;">P/VP</th>
<th style="text-align: left;">Patrim. Líq</th>
<th style="text-align: left;">PSR</th>
<th style="text-align: left;">Receita Líquida_ult_12_meses</th>
<th style="text-align: left;">Receita Líquida_ult_3_meses</th>
<th style="text-align: left;">ROE</th>
<th style="text-align: left;">ROIC</th>
<th style="text-align: left;">Setor</th>
<th style="text-align: left;">Subsetor</th>
<th style="text-align: left;">Valor da firma</th>
<th style="text-align: left;">Valor de mercado</th>
<th style="text-align: left;">VPA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">VALE3</td>
<td style="text-align: left;">445.621.000.000</td>
<td style="text-align: left;">73.474.000.000</td>
<td style="text-align: left;">10,7%</td>
<td style="text-align: left;">20.168.000.000</td>
<td style="text-align: left;">0,37</td>
<td style="text-align: left;">70.289.000.000</td>
<td style="text-align: left;">50.121.000.000</td>
<td style="text-align: left;">5,7%</td>
<td style="text-align: left;">17,9%</td>
<td style="text-align: left;">79.954.000.000</td>
<td style="text-align: left;">20.379.000.000</td>
<td style="text-align: left;">4,69</td>
<td style="text-align: left;">3,91</td>
<td style="text-align: left;">0,46</td>
<td style="text-align: left;">1,08</td>
<td style="text-align: left;">10,47</td>
<td style="text-align: left;">47.517.000.000</td>
<td style="text-align: left;">13.864.000.000</td>
<td style="text-align: left;">40,1%</td>
<td style="text-align: left;">38,8%</td>
<td style="text-align: left;">23,3%</td>
<td style="text-align: left;">4.539.010.000</td>
<td style="text-align: left;">-1,86</td>
<td style="text-align: left;">0,73</td>
<td style="text-align: left;">62,99</td>
<td style="text-align: left;">4,06</td>
<td style="text-align: left;">6,83</td>
<td style="text-align: left;">1,71</td>
<td style="text-align: left;">190.172.000.000</td>
<td style="text-align: left;">1,57</td>
<td style="text-align: left;">206.296.000.000</td>
<td style="text-align: left;">51.962.000.000</td>
<td style="text-align: left;">25,0%</td>
<td style="text-align: left;">20,1%</td>
<td style="text-align: left;">Mineração</td>
<td style="text-align: left;">Minerais Metálicos</td>
<td style="text-align: left;">374.660.000.000</td>
<td style="text-align: left;">324.539.000.000</td>
<td style="text-align: left;">41,90</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Com a nossa função já criada e testada, vamos partir para a segunda etapa deste processo que é a seleção dos ativos que vamos extrair. Para isso, vamos pedir auxílio ao chatGPT.</p>
</section>
</section>
<section id="selecionando-os-ativos" class="level3">
<h3 class="anchored" data-anchor-id="selecionando-os-ativos">2. Selecionando os ativos</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R para ler o arquivo csv “Ativos_IBOV.csv”, considerando “latin1” como codificação do arquivo e “;” como separador dos valores. Promova a 1ª linha dos dados como nome da coluna e selecione apenas as duas colunas “Setor” e “Código” .</p>
<p>Filtre também os dados em que a coluna “Setor” não tenha um registro que comece com “Financ e Outros” e selecione aleatoriamente 40 ativos dessa base. Use o pacote dplyr para a filtragem e seleção dos dados.</p>
</div>
</div>
<section id="código-9" class="level4">
<h4 class="anchored" data-anchor-id="código-9">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leitura do arquivo CSV</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Ativos_IBOV.csv"</span>, <span class="at">encoding =</span> <span class="st">"latin1"</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   86 obs. of  7 variables:
 $ Setor         : chr  "Bens Indls / Máqs e Equips" "Bens Indls / Mat Transporte" "Bens Indls/Transporte" "Bens Indls/Transporte" ...
 $ Código        : chr  "WEGE3" "EMBR3" "AZUL4" "CCRO3" ...
 $ Ação          : chr  "WEG" "EMBRAER" "AZUL" "CCR SA" ...
 $ Tipo          : chr  "ON      NM" "ON      NM" "PN      N2" "ON  ED  NM" ...
 $ Qtde..Teórica : chr  "1.481.593.024" "734.632.705" "327.593.725" "995.335.937" ...
 $ Part.....     : chr  "2,406" "0,664" "0,225" "0,595" ...
 $ Part.....Acum.: chr  "2,406" "0,664" "2,269" "2,269" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtragem e seleção de colunas</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>dados_filtrados <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^Financ e Outros"</span>, Setor)) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Setor, Código)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_filtrados)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   74 obs. of  2 variables:
 $ Setor : chr  "Bens Indls / Máqs e Equips" "Bens Indls / Mat Transporte" "Bens Indls/Transporte" "Bens Indls/Transporte" ...
 $ Código: chr  "WEGE3" "EMBR3" "AZUL4" "CCRO3" ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Amostragem aleatória de 40 ativos</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>) <span class="co"># aplicando uma reprodutibilidade</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>amostra <span class="ot">&lt;-</span> dados_filtrados <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Armazenar a coluna "Código" na variável "ibov"</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ibov <span class="ot">&lt;-</span> amostra<span class="sc">$</span>Código</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>ibov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "PETR4"  "CMIG4"  "CYRE3"  "ARZZ3"  "TAEE11" "CSAN3"  "ALPA4"  "SUZB3" 
 [9] "SOMA3"  "EZTC3"  "RECV3"  "ELET6"  "AZUL4"  "BRKM5"  "EGIE3"  "MRVE3" 
[17] "KLBN11" "CPFE3"  "VAMO3"  "USIM5"  "GOLL4"  "CPLE6"  "CIEL3"  "CVCB3" 
[25] "VALE3"  "VIVT3"  "B3SA3"  "GGBR4"  "ELET3"  "RENT3"  "GOAU4"  "PCAR3" 
[33] "MGLU3"  "JBSS3"  "HAPV3"  "CCRO3"  "TIMS3"  "ENEV3"  "PRIO3"  "VBBR3" </code></pre>
</div>
</div>
<p>Agora que já definimos a nossa amostra com os ativos que vamos extrair os dados, vamos aplicar a função para resgatar os indicadores de todos eles a fim de criar uma única tabela com os dados consolidados. Novamente, vamos perguntar como construir esse código para o ChatGPT.</p>
</section>
</section>
<section id="extraindo-os-dados-dos-ativos-selecionados" class="level3">
<h3 class="anchored" data-anchor-id="extraindo-os-dados-dos-ativos-selecionados">3. Extraindo os dados dos ativos selecionados</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suponha que você tem uma função chamada “indicadores” que obtém indicadores para um ativo específico e uma lista chamada “ibov” contendo os nomes dos ativos. Gere o código que execute a função que obtem os indicadores dos ativos para cada ativo, gerando um único dataframe.</p>
</div>
</div>
<section id="código-10" class="level4">
<h4 class="anchored" data-anchor-id="código-10">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use lapply para chamar a função para cada ativo e obter uma lista de data frames</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>dfs <span class="ot">&lt;-</span> <span class="fu">lapply</span>(ibov, indicadores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine os data frames em um único data frame</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>dados_completos <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dados_completos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 2%">
<col style="width: 0%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Ação</th>
<th style="text-align: left;">Ativo</th>
<th style="text-align: left;">Ativo Circulante</th>
<th style="text-align: left;">Cres. Rec (5a)</th>
<th style="text-align: left;">Disponibilidades</th>
<th style="text-align: left;">Div Br/ Patrim</th>
<th style="text-align: left;">Dív. Bruta</th>
<th style="text-align: left;">Dív. Líquida</th>
<th style="text-align: left;">Div. Yield</th>
<th style="text-align: left;">EBIT / Ativo</th>
<th style="text-align: left;">EBIT_ult_12_meses</th>
<th style="text-align: left;">EBIT_ult_3_meses</th>
<th style="text-align: left;">EV / EBIT</th>
<th style="text-align: left;">EV / EBITDA</th>
<th style="text-align: left;">Giro Ativos</th>
<th style="text-align: left;">Liquidez Corr</th>
<th style="text-align: left;">LPA</th>
<th style="text-align: left;">Lucro Líquido_ult_12_meses</th>
<th style="text-align: left;">Lucro Líquido_ult_3_meses</th>
<th style="text-align: left;">Marg. Bruta</th>
<th style="text-align: left;">Marg. EBIT</th>
<th style="text-align: left;">Marg. Líquida</th>
<th style="text-align: left;">Nro. Ações</th>
<th style="text-align: left;">P/Ativ Circ Liq</th>
<th style="text-align: left;">P/Ativos</th>
<th style="text-align: left;">P/Cap. Giro</th>
<th style="text-align: left;">P/EBIT</th>
<th style="text-align: left;">P/L</th>
<th style="text-align: left;">P/VP</th>
<th style="text-align: left;">Patrim. Líq</th>
<th style="text-align: left;">PSR</th>
<th style="text-align: left;">Receita Líquida_ult_12_meses</th>
<th style="text-align: left;">Receita Líquida_ult_3_meses</th>
<th style="text-align: left;">ROE</th>
<th style="text-align: left;">ROIC</th>
<th style="text-align: left;">Setor</th>
<th style="text-align: left;">Subsetor</th>
<th style="text-align: left;">Valor da firma</th>
<th style="text-align: left;">Valor de mercado</th>
<th style="text-align: left;">VPA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PETR4</td>
<td style="text-align: left;">990.459.000.000</td>
<td style="text-align: left;">136.816.000.000</td>
<td style="text-align: left;">19,4%</td>
<td style="text-align: left;">60.985.000.000</td>
<td style="text-align: left;">0,75</td>
<td style="text-align: left;">279.375.000.000</td>
<td style="text-align: left;">218.390.000.000</td>
<td style="text-align: left;">26,1%</td>
<td style="text-align: left;">26,4%</td>
<td style="text-align: left;">261.516.000.000</td>
<td style="text-align: left;">49.813.000.000</td>
<td style="text-align: left;">2,61</td>
<td style="text-align: left;">2,03</td>
<td style="text-align: left;">0,59</td>
<td style="text-align: left;">0,90</td>
<td style="text-align: left;">11,99</td>
<td style="text-align: left;">156.375.000.000</td>
<td style="text-align: left;">28.782.000.000</td>
<td style="text-align: left;">50,6%</td>
<td style="text-align: left;">45,0%</td>
<td style="text-align: left;">27,0%</td>
<td style="text-align: left;">13.044.500.000</td>
<td style="text-align: left;">-0,96</td>
<td style="text-align: left;">0,47</td>
<td style="text-align: left;">-31,33</td>
<td style="text-align: left;">1,77</td>
<td style="text-align: left;">2,96</td>
<td style="text-align: left;">1,25</td>
<td style="text-align: left;">370.683.000.000</td>
<td style="text-align: left;">0,80</td>
<td style="text-align: left;">581.563.000.000</td>
<td style="text-align: left;">113.840.000.000</td>
<td style="text-align: left;">42,2%</td>
<td style="text-align: left;">29,0%</td>
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: left;">Exploração, Refino e Distribuição</td>
<td style="text-align: left;">681.600.000.000</td>
<td style="text-align: left;">463.210.000.000</td>
<td style="text-align: left;">28,42</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMIG4</td>
<td style="text-align: left;">54.543.100.000</td>
<td style="text-align: left;">13.540.400.000</td>
<td style="text-align: left;">11,8%</td>
<td style="text-align: left;">3.725.800.000</td>
<td style="text-align: left;">0,50</td>
<td style="text-align: left;">11.831.000.000</td>
<td style="text-align: left;">8.105.240.000</td>
<td style="text-align: left;">8,7%</td>
<td style="text-align: left;">14,5%</td>
<td style="text-align: left;">7.899.710.000</td>
<td style="text-align: left;">1.828.940.000</td>
<td style="text-align: left;">4,56</td>
<td style="text-align: left;">3,95</td>
<td style="text-align: left;">0,66</td>
<td style="text-align: left;">1,34</td>
<td style="text-align: left;">3,01</td>
<td style="text-align: left;">6.627.360.000</td>
<td style="text-align: left;">2.642.220.000</td>
<td style="text-align: left;">23,8%</td>
<td style="text-align: left;">22,0%</td>
<td style="text-align: left;">18,5%</td>
<td style="text-align: left;">2.201.370.000</td>
<td style="text-align: left;">-1,61</td>
<td style="text-align: left;">0,51</td>
<td style="text-align: left;">8,18</td>
<td style="text-align: left;">3,53</td>
<td style="text-align: left;">4,21</td>
<td style="text-align: left;">1,18</td>
<td style="text-align: left;">23.609.100.000</td>
<td style="text-align: left;">0,78</td>
<td style="text-align: left;">35.868.400.000</td>
<td style="text-align: left;">8.819.520.000</td>
<td style="text-align: left;">28,1%</td>
<td style="text-align: left;">16,3%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">36.018.600.000</td>
<td style="text-align: left;">27.913.400.000</td>
<td style="text-align: left;">10,72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CYRE3</td>
<td style="text-align: left;">16.825.100.000</td>
<td style="text-align: left;">8.840.340.000</td>
<td style="text-align: left;">12,2%</td>
<td style="text-align: left;">2.883.690.000</td>
<td style="text-align: left;">0,64</td>
<td style="text-align: left;">4.842.230.000</td>
<td style="text-align: left;">1.958.540.000</td>
<td style="text-align: left;">2,6%</td>
<td style="text-align: left;">4,6%</td>
<td style="text-align: left;">766.088.000</td>
<td style="text-align: left;">253.043.000</td>
<td style="text-align: left;">12,76</td>
<td style="text-align: left;">12,10</td>
<td style="text-align: left;">0,35</td>
<td style="text-align: left;">2,65</td>
<td style="text-align: left;">2,35</td>
<td style="text-align: left;">939.291.000</td>
<td style="text-align: left;">279.385.000</td>
<td style="text-align: left;">32,2%</td>
<td style="text-align: left;">13,1%</td>
<td style="text-align: left;">16,6%</td>
<td style="text-align: left;">399.743.000</td>
<td style="text-align: left;">30,19</td>
<td style="text-align: left;">0,46</td>
<td style="text-align: left;">1,42</td>
<td style="text-align: left;">10,20</td>
<td style="text-align: left;">8,32</td>
<td style="text-align: left;">1,04</td>
<td style="text-align: left;">7.519.980.000</td>
<td style="text-align: left;">1,34</td>
<td style="text-align: left;">5.847.040.000</td>
<td style="text-align: left;">1.633.050.000</td>
<td style="text-align: left;">12,5%</td>
<td style="text-align: left;">5,6%</td>
<td style="text-align: left;">Construção Civil</td>
<td style="text-align: left;">Incorporações</td>
<td style="text-align: left;">9.773.520.000</td>
<td style="text-align: left;">7.814.980.000</td>
<td style="text-align: left;">18,81</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARZZ3</td>
<td style="text-align: left;">5.435.060.000</td>
<td style="text-align: left;">2.771.140.000</td>
<td style="text-align: left;">35,7%</td>
<td style="text-align: left;">682.038.000</td>
<td style="text-align: left;">0,37</td>
<td style="text-align: left;">1.028.030.000</td>
<td style="text-align: left;">345.987.000</td>
<td style="text-align: left;">2,7%</td>
<td style="text-align: left;">9,0%</td>
<td style="text-align: left;">487.797.000</td>
<td style="text-align: left;">124.657.000</td>
<td style="text-align: left;">13,95</td>
<td style="text-align: left;">9,87</td>
<td style="text-align: left;">0,85</td>
<td style="text-align: left;">1,63</td>
<td style="text-align: left;">3,33</td>
<td style="text-align: left;">369.973.000</td>
<td style="text-align: left;">100.626.000</td>
<td style="text-align: left;">53,4%</td>
<td style="text-align: left;">10,6%</td>
<td style="text-align: left;">8,0%</td>
<td style="text-align: left;">110.989.000</td>
<td style="text-align: left;">45,56</td>
<td style="text-align: left;">1,19</td>
<td style="text-align: left;">6,05</td>
<td style="text-align: left;">13,24</td>
<td style="text-align: left;">17,46</td>
<td style="text-align: left;">2,32</td>
<td style="text-align: left;">2.783.100.000</td>
<td style="text-align: left;">1,40</td>
<td style="text-align: left;">4.605.710.000</td>
<td style="text-align: left;">1.131.020.000</td>
<td style="text-align: left;">13,3%</td>
<td style="text-align: left;">11,4%</td>
<td style="text-align: left;">Comércio</td>
<td style="text-align: left;">Tecidos, Vestuário e Calçados</td>
<td style="text-align: left;">6.804.440.000</td>
<td style="text-align: left;">6.458.450.000</td>
<td style="text-align: left;">25,08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TAEE11</td>
<td style="text-align: left;">18.812.300.000</td>
<td style="text-align: left;">3.598.340.000</td>
<td style="text-align: left;">9,3%</td>
<td style="text-align: left;">1.323.640.000</td>
<td style="text-align: left;">1,41</td>
<td style="text-align: left;">9.426.130.000</td>
<td style="text-align: left;">8.102.490.000</td>
<td style="text-align: left;">9,6%</td>
<td style="text-align: left;">7,9%</td>
<td style="text-align: left;">1.479.750.000</td>
<td style="text-align: left;">387.548.000</td>
<td style="text-align: left;">13,66</td>
<td style="text-align: left;">13,47</td>
<td style="text-align: left;">0,12</td>
<td style="text-align: left;">3,03</td>
<td style="text-align: left;">3,39</td>
<td style="text-align: left;">1.167.790.000</td>
<td style="text-align: left;">220.426.000</td>
<td style="text-align: left;">70,9%</td>
<td style="text-align: left;">63,1%</td>
<td style="text-align: left;">49,8%</td>
<td style="text-align: left;">1.033.500.000</td>
<td style="text-align: left;">-1,42</td>
<td style="text-align: left;">0,64</td>
<td style="text-align: left;">5,02</td>
<td style="text-align: left;">8,18</td>
<td style="text-align: left;">10,37</td>
<td style="text-align: left;">1,81</td>
<td style="text-align: left;">6.689.300.000</td>
<td style="text-align: left;">5,16</td>
<td style="text-align: left;">2.344.570.000</td>
<td style="text-align: left;">678.504.000</td>
<td style="text-align: left;">17,5%</td>
<td style="text-align: left;">8,5%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">20.208.200.000</td>
<td style="text-align: left;">12.105.700.000</td>
<td style="text-align: left;">19,42</td>
</tr>
<tr class="even">
<td style="text-align: left;">CSAN3</td>
<td style="text-align: left;">135.039.000.000</td>
<td style="text-align: left;">28.005.500.000</td>
<td style="text-align: left;">39,8%</td>
<td style="text-align: left;">15.739.300.000</td>
<td style="text-align: left;">3,36</td>
<td style="text-align: left;">60.243.300.000</td>
<td style="text-align: left;">44.504.000.000</td>
<td style="text-align: left;">2,5%</td>
<td style="text-align: left;">4,8%</td>
<td style="text-align: left;">6.543.610.000</td>
<td style="text-align: left;">1.939.560.000</td>
<td style="text-align: left;">11,75</td>
<td style="text-align: left;">7,94</td>
<td style="text-align: left;">0,31</td>
<td style="text-align: left;">1,65</td>
<td style="text-align: left;">-0,62</td>
<td style="text-align: left;">-1.155.700.000</td>
<td style="text-align: left;">-1.042.700.000</td>
<td style="text-align: left;">24,7%</td>
<td style="text-align: left;">15,6%</td>
<td style="text-align: left;">3,2%</td>
<td style="text-align: left;">1.874.070.000</td>
<td style="text-align: left;">-0,53</td>
<td style="text-align: left;">0,24</td>
<td style="text-align: left;">2,92</td>
<td style="text-align: left;">4,95</td>
<td style="text-align: left;">-28,00</td>
<td style="text-align: left;">1,81</td>
<td style="text-align: left;">17.929.300.000</td>
<td style="text-align: left;">0,77</td>
<td style="text-align: left;">41.903.200.000</td>
<td style="text-align: left;">10.010.500.000</td>
<td style="text-align: left;">-6,4%</td>
<td style="text-align: left;">5,7%</td>
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: left;">Exploração, Refino e Distribuição</td>
<td style="text-align: left;">76.869.200.000</td>
<td style="text-align: left;">32.365.200.000</td>
<td style="text-align: left;">9,57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ALPA4</td>
<td style="text-align: left;">7.766.710.000</td>
<td style="text-align: left;">2.923.670.000</td>
<td style="text-align: left;">2,0%</td>
<td style="text-align: left;">414.288.000</td>
<td style="text-align: left;">0,25</td>
<td style="text-align: left;">1.351.150.000</td>
<td style="text-align: left;">936.861.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">2,8%</td>
<td style="text-align: left;">220.108.000</td>
<td style="text-align: left;">-58.996.000</td>
<td style="text-align: left;">31,78</td>
<td style="text-align: left;">17,44</td>
<td style="text-align: left;">0,52</td>
<td style="text-align: left;">2,50</td>
<td style="text-align: left;">-0,33</td>
<td style="text-align: left;">-228.109.000</td>
<td style="text-align: left;">-52.853.000</td>
<td style="text-align: left;">42,2%</td>
<td style="text-align: left;">5,5%</td>
<td style="text-align: left;">-5,7%</td>
<td style="text-align: left;">683.062.000</td>
<td style="text-align: left;">12,95</td>
<td style="text-align: left;">0,78</td>
<td style="text-align: left;">3,45</td>
<td style="text-align: left;">27,53</td>
<td style="text-align: left;">-26,56</td>
<td style="text-align: left;">1,14</td>
<td style="text-align: left;">5.309.890.000</td>
<td style="text-align: left;">1,51</td>
<td style="text-align: left;">4.022.150.000</td>
<td style="text-align: left;">926.359.000</td>
<td style="text-align: left;">-4,3%</td>
<td style="text-align: left;">3,2%</td>
<td style="text-align: left;">Tecidos, Vestuário e Calçados</td>
<td style="text-align: left;">Calçados</td>
<td style="text-align: left;">6.995.620.000</td>
<td style="text-align: left;">6.058.760.000</td>
<td style="text-align: left;">7,77</td>
</tr>
<tr class="even">
<td style="text-align: left;">SUZB3</td>
<td style="text-align: left;">141.618.000.000</td>
<td style="text-align: left;">38.226.600.000</td>
<td style="text-align: left;">20,0%</td>
<td style="text-align: left;">20.473.700.000</td>
<td style="text-align: left;">1,88</td>
<td style="text-align: left;">78.551.000.000</td>
<td style="text-align: left;">58.077.300.000</td>
<td style="text-align: left;">3,6%</td>
<td style="text-align: left;">10,0%</td>
<td style="text-align: left;">14.190.500.000</td>
<td style="text-align: left;">1.699.290.000</td>
<td style="text-align: left;">8,93</td>
<td style="text-align: left;">5,86</td>
<td style="text-align: left;">0,31</td>
<td style="text-align: left;">2,82</td>
<td style="text-align: left;">12,86</td>
<td style="text-align: left;">17.033.900.000</td>
<td style="text-align: left;">-732.993.000</td>
<td style="text-align: left;">42,6%</td>
<td style="text-align: left;">32,4%</td>
<td style="text-align: left;">39,0%</td>
<td style="text-align: left;">1.324.120.000</td>
<td style="text-align: left;">-1,12</td>
<td style="text-align: left;">0,49</td>
<td style="text-align: left;">2,79</td>
<td style="text-align: left;">4,84</td>
<td style="text-align: left;">4,03</td>
<td style="text-align: left;">1,65</td>
<td style="text-align: left;">41.762.300.000</td>
<td style="text-align: left;">1,57</td>
<td style="text-align: left;">43.753.700.000</td>
<td style="text-align: left;">8.948.010.000</td>
<td style="text-align: left;">40,8%</td>
<td style="text-align: left;">12,3%</td>
<td style="text-align: left;">Madeira e Papel</td>
<td style="text-align: left;">Papel e Celulose</td>
<td style="text-align: left;">126.786.000.000</td>
<td style="text-align: left;">68.708.500.000</td>
<td style="text-align: left;">31,54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SOMA3</td>
<td style="text-align: left;">10.746.100.000</td>
<td style="text-align: left;">3.385.580.000</td>
<td style="text-align: left;">78,2%</td>
<td style="text-align: left;">240.585.000</td>
<td style="text-align: left;">0,19</td>
<td style="text-align: left;">1.462.910.000</td>
<td style="text-align: left;">1.222.330.000</td>
<td style="text-align: left;">1,8%</td>
<td style="text-align: left;">5,1%</td>
<td style="text-align: left;">551.041.000</td>
<td style="text-align: left;">150.743.000</td>
<td style="text-align: left;">10,11</td>
<td style="text-align: left;">6,80</td>
<td style="text-align: left;">0,48</td>
<td style="text-align: left;">2,16</td>
<td style="text-align: left;">0,39</td>
<td style="text-align: left;">308.877.000</td>
<td style="text-align: left;">85.371.000</td>
<td style="text-align: left;">56,7%</td>
<td style="text-align: left;">10,7%</td>
<td style="text-align: left;">6,0%</td>
<td style="text-align: left;">784.747.000</td>
<td style="text-align: left;">24,10</td>
<td style="text-align: left;">0,40</td>
<td style="text-align: left;">2,39</td>
<td style="text-align: left;">7,89</td>
<td style="text-align: left;">14,08</td>
<td style="text-align: left;">0,58</td>
<td style="text-align: left;">7.540.900.000</td>
<td style="text-align: left;">0,84</td>
<td style="text-align: left;">5.145.330.000</td>
<td style="text-align: left;">1.295.160.000</td>
<td style="text-align: left;">4,1%</td>
<td style="text-align: left;">5,6%</td>
<td style="text-align: left;">Comércio</td>
<td style="text-align: left;">Tecidos, Vestuário e Calçados</td>
<td style="text-align: left;">5.569.830.000</td>
<td style="text-align: left;">4.347.500.000</td>
<td style="text-align: left;">9,61</td>
</tr>
<tr class="even">
<td style="text-align: left;">EZTC3</td>
<td style="text-align: left;">5.708.400.000</td>
<td style="text-align: left;">2.329.850.000</td>
<td style="text-align: left;">16,3%</td>
<td style="text-align: left;">781.417.000</td>
<td style="text-align: left;">0,15</td>
<td style="text-align: left;">683.156.000</td>
<td style="text-align: left;">-98.261.100</td>
<td style="text-align: left;">1,8%</td>
<td style="text-align: left;">1,6%</td>
<td style="text-align: left;">93.466.000</td>
<td style="text-align: left;">13.036.000</td>
<td style="text-align: left;">35,36</td>
<td style="text-align: left;">29,25</td>
<td style="text-align: left;">0,19</td>
<td style="text-align: left;">5,14</td>
<td style="text-align: left;">1,15</td>
<td style="text-align: left;">254.495.000</td>
<td style="text-align: left;">75.333.000</td>
<td style="text-align: left;">31,1%</td>
<td style="text-align: left;">8,6%</td>
<td style="text-align: left;">24,4%</td>
<td style="text-align: left;">220.989.000</td>
<td style="text-align: left;">2,69</td>
<td style="text-align: left;">0,60</td>
<td style="text-align: left;">1,81</td>
<td style="text-align: left;">36,41</td>
<td style="text-align: left;">13,37</td>
<td style="text-align: left;">0,74</td>
<td style="text-align: left;">4.577.180.000</td>
<td style="text-align: left;">3,14</td>
<td style="text-align: left;">1.085.060.000</td>
<td style="text-align: left;">242.732.000</td>
<td style="text-align: left;">5,6%</td>
<td style="text-align: left;">1,9%</td>
<td style="text-align: left;">Construção Civil</td>
<td style="text-align: left;">Incorporações</td>
<td style="text-align: left;">3.304.970.000</td>
<td style="text-align: left;">3.403.230.000</td>
<td style="text-align: left;">20,71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RECV3</td>
<td style="text-align: left;">6.767.580.000</td>
<td style="text-align: left;">1.254.770.000</td>
<td style="text-align: left;">52,5%</td>
<td style="text-align: left;">785.484.000</td>
<td style="text-align: left;">0,14</td>
<td style="text-align: left;">608.615.000</td>
<td style="text-align: left;">-176.869.000</td>
<td style="text-align: left;">5,2%</td>
<td style="text-align: left;">16,1%</td>
<td style="text-align: left;">1.089.570.000</td>
<td style="text-align: left;">149.739.000</td>
<td style="text-align: left;">5,32</td>
<td style="text-align: left;">3,77</td>
<td style="text-align: left;">0,44</td>
<td style="text-align: left;">0,90</td>
<td style="text-align: left;">3,40</td>
<td style="text-align: left;">997.676.000</td>
<td style="text-align: left;">177.641.000</td>
<td style="text-align: left;">40,9%</td>
<td style="text-align: left;">36,8%</td>
<td style="text-align: left;">33,7%</td>
<td style="text-align: left;">293.281.000</td>
<td style="text-align: left;">-4,98</td>
<td style="text-align: left;">0,88</td>
<td style="text-align: left;">-42,01</td>
<td style="text-align: left;">5,48</td>
<td style="text-align: left;">5,98</td>
<td style="text-align: left;">1,38</td>
<td style="text-align: left;">4.314.600.000</td>
<td style="text-align: left;">2,02</td>
<td style="text-align: left;">2.958.980.000</td>
<td style="text-align: left;">658.314.000</td>
<td style="text-align: left;">23,1%</td>
<td style="text-align: left;">19,4%</td>
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: left;">Exploração, Refino e Distribuição</td>
<td style="text-align: left;">5.791.400.000</td>
<td style="text-align: left;">5.968.270.000</td>
<td style="text-align: left;">14,71</td>
</tr>
<tr class="even">
<td style="text-align: left;">ELET6</td>
<td style="text-align: left;">263.464.000.000</td>
<td style="text-align: left;">43.749.200.000</td>
<td style="text-align: left;">17,1%</td>
<td style="text-align: left;">20.193.500.000</td>
<td style="text-align: left;">0,51</td>
<td style="text-align: left;">57.369.400.000</td>
<td style="text-align: left;">37.175.900.000</td>
<td style="text-align: left;">3,7%</td>
<td style="text-align: left;">3,3%</td>
<td style="text-align: left;">8.704.280.000</td>
<td style="text-align: left;">4.993.900.000</td>
<td style="text-align: left;">15,08</td>
<td style="text-align: left;">10,76</td>
<td style="text-align: left;">0,13</td>
<td style="text-align: left;">1,47</td>
<td style="text-align: left;">0,74</td>
<td style="text-align: left;">1.703.340.000</td>
<td style="text-align: left;">1.685.230.000</td>
<td style="text-align: left;">49,6%</td>
<td style="text-align: left;">25,2%</td>
<td style="text-align: left;">4,5%</td>
<td style="text-align: left;">2.307.100.000</td>
<td style="text-align: left;">-0,87</td>
<td style="text-align: left;">0,36</td>
<td style="text-align: left;">6,76</td>
<td style="text-align: left;">10,81</td>
<td style="text-align: left;">55,22</td>
<td style="text-align: left;">0,84</td>
<td style="text-align: left;">111.402.000.000</td>
<td style="text-align: left;">2,73</td>
<td style="text-align: left;">34.492.200.000</td>
<td style="text-align: left;">9.245.530.000</td>
<td style="text-align: left;">1,5%</td>
<td style="text-align: left;">3,6%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">131.236.000.000</td>
<td style="text-align: left;">94.060.500.000</td>
<td style="text-align: left;">48,29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AZUL4</td>
<td style="text-align: left;">17.122.000.000</td>
<td style="text-align: left;">4.628.300.000</td>
<td style="text-align: left;">15,8%</td>
<td style="text-align: left;">616.210.000</td>
<td style="text-align: left;">-1,13</td>
<td style="text-align: left;">22.223.200.000</td>
<td style="text-align: left;">21.607.000.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">13,0%</td>
<td style="text-align: left;">2.234.030.000</td>
<td style="text-align: left;">401.726.000</td>
<td style="text-align: left;">11,76</td>
<td style="text-align: left;">5,81</td>
<td style="text-align: left;">1,03</td>
<td style="text-align: left;">0,28</td>
<td style="text-align: left;">-4,66</td>
<td style="text-align: left;">-1.621.680.000</td>
<td style="text-align: left;">23.908.000</td>
<td style="text-align: left;">19,6%</td>
<td style="text-align: left;">12,7%</td>
<td style="text-align: left;">-9,2%</td>
<td style="text-align: left;">348.084.000</td>
<td style="text-align: left;">-0,14</td>
<td style="text-align: left;">0,27</td>
<td style="text-align: left;">-0,38</td>
<td style="text-align: left;">2,09</td>
<td style="text-align: left;">-2,87</td>
<td style="text-align: left;">-0,24</td>
<td style="text-align: left;">-19.682.000.000</td>
<td style="text-align: left;">0,27</td>
<td style="text-align: left;">17.562.800.000</td>
<td style="text-align: left;">4.254.190.000</td>
<td style="text-align: left;">8,2%</td>
<td style="text-align: left;">16,4%</td>
<td style="text-align: left;">Transporte</td>
<td style="text-align: left;">Transporte Aéreo</td>
<td style="text-align: left;">26.267.900.000</td>
<td style="text-align: left;">4.660.840.000</td>
<td style="text-align: left;">-56,54</td>
</tr>
<tr class="even">
<td style="text-align: left;">BRKM5</td>
<td style="text-align: left;">88.009.200.000</td>
<td style="text-align: left;">34.339.100.000</td>
<td style="text-align: left;">15,9%</td>
<td style="text-align: left;">15.580.200.000</td>
<td style="text-align: left;">5,19</td>
<td style="text-align: left;">37.533.900.000</td>
<td style="text-align: left;">21.953.700.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">-1,7%</td>
<td style="text-align: left;">-1.486.760.000</td>
<td style="text-align: left;">-675.560.000</td>
<td style="text-align: left;">-24,27</td>
<td style="text-align: left;">9,87</td>
<td style="text-align: left;">0,93</td>
<td style="text-align: left;">1,49</td>
<td style="text-align: left;">-4,26</td>
<td style="text-align: left;">-3.399.620.000</td>
<td style="text-align: left;">-770.600.000</td>
<td style="text-align: left;">4,4%</td>
<td style="text-align: left;">-1,8%</td>
<td style="text-align: left;">-4,8%</td>
<td style="text-align: left;">797.208.000</td>
<td style="text-align: left;">-0,30</td>
<td style="text-align: left;">0,16</td>
<td style="text-align: left;">1,26</td>
<td style="text-align: left;">-9,51</td>
<td style="text-align: left;">-4,16</td>
<td style="text-align: left;">1,95</td>
<td style="text-align: left;">7.232.560.000</td>
<td style="text-align: left;">0,17</td>
<td style="text-align: left;">81.578.800.000</td>
<td style="text-align: left;">17.756.200.000</td>
<td style="text-align: left;">-47,0%</td>
<td style="text-align: left;">-2,5%</td>
<td style="text-align: left;">Químicos</td>
<td style="text-align: left;">Petroquímicos</td>
<td style="text-align: left;">36.088.200.000</td>
<td style="text-align: left;">14.134.500.000</td>
<td style="text-align: left;">9,07</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EGIE3</td>
<td style="text-align: left;">39.397.400.000</td>
<td style="text-align: left;">6.324.340.000</td>
<td style="text-align: left;">3,9%</td>
<td style="text-align: left;">3.085.250.000</td>
<td style="text-align: left;">2,12</td>
<td style="text-align: left;">17.855.700.000</td>
<td style="text-align: left;">14.770.400.000</td>
<td style="text-align: left;">8,7%</td>
<td style="text-align: left;">14,0%</td>
<td style="text-align: left;">5.521.680.000</td>
<td style="text-align: left;">1.216.800.000</td>
<td style="text-align: left;">8,72</td>
<td style="text-align: left;">7,47</td>
<td style="text-align: left;">0,28</td>
<td style="text-align: left;">1,09</td>
<td style="text-align: left;">4,13</td>
<td style="text-align: left;">3.371.920.000</td>
<td style="text-align: left;">867.279.000</td>
<td style="text-align: left;">53,4%</td>
<td style="text-align: left;">49,6%</td>
<td style="text-align: left;">30,3%</td>
<td style="text-align: left;">815.928.000</td>
<td style="text-align: left;">-1,41</td>
<td style="text-align: left;">0,85</td>
<td style="text-align: left;">64,52</td>
<td style="text-align: left;">6,04</td>
<td style="text-align: left;">9,89</td>
<td style="text-align: left;">3,95</td>
<td style="text-align: left;">8.436.830.000</td>
<td style="text-align: left;">2,99</td>
<td style="text-align: left;">11.138.200.000</td>
<td style="text-align: left;">2.513.510.000</td>
<td style="text-align: left;">40,0%</td>
<td style="text-align: left;">15,5%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">48.125.500.000</td>
<td style="text-align: left;">33.355.100.000</td>
<td style="text-align: left;">10,34</td>
</tr>
<tr class="even">
<td style="text-align: left;">MRVE3</td>
<td style="text-align: left;">23.344.700.000</td>
<td style="text-align: left;">11.008.300.000</td>
<td style="text-align: left;">4,3%</td>
<td style="text-align: left;">609.856.000</td>
<td style="text-align: left;">1,35</td>
<td style="text-align: left;">8.128.290.000</td>
<td style="text-align: left;">7.518.430.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">0,3%</td>
<td style="text-align: left;">72.091.100</td>
<td style="text-align: left;">54.017.000</td>
<td style="text-align: left;">174,84</td>
<td style="text-align: left;">53,14</td>
<td style="text-align: left;">0,29</td>
<td style="text-align: left;">2,06</td>
<td style="text-align: left;">-0,18</td>
<td style="text-align: left;">-98.926.000</td>
<td style="text-align: left;">181.098.000</td>
<td style="text-align: left;">20,8%</td>
<td style="text-align: left;">1,0%</td>
<td style="text-align: left;">-0,9%</td>
<td style="text-align: left;">561.971.000</td>
<td style="text-align: left;">-0,92</td>
<td style="text-align: left;">0,22</td>
<td style="text-align: left;">0,90</td>
<td style="text-align: left;">70,55</td>
<td style="text-align: left;">-51,41</td>
<td style="text-align: left;">0,84</td>
<td style="text-align: left;">6.018.990.000</td>
<td style="text-align: left;">0,74</td>
<td style="text-align: left;">6.884.090.000</td>
<td style="text-align: left;">1.825.660.000</td>
<td style="text-align: left;">-1,6%</td>
<td style="text-align: left;">0,3%</td>
<td style="text-align: left;">Construção Civil</td>
<td style="text-align: left;">Incorporações</td>
<td style="text-align: left;">12.604.300.000</td>
<td style="text-align: left;">5.085.840.000</td>
<td style="text-align: left;">10,71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KLBN11</td>
<td style="text-align: left;">51.693.700.000</td>
<td style="text-align: left;">13.576.600.000</td>
<td style="text-align: left;">18,3%</td>
<td style="text-align: left;">7.853.130.000</td>
<td style="text-align: left;">2,57</td>
<td style="text-align: left;">28.734.800.000</td>
<td style="text-align: left;">20.881.700.000</td>
<td style="text-align: left;">5,6%</td>
<td style="text-align: left;">8,9%</td>
<td style="text-align: left;">4.587.690.000</td>
<td style="text-align: left;">685.380.000</td>
<td style="text-align: left;">9,98</td>
<td style="text-align: left;">5,91</td>
<td style="text-align: left;">0,36</td>
<td style="text-align: left;">2,16</td>
<td style="text-align: left;">2,56</td>
<td style="text-align: left;">2.879.830.000</td>
<td style="text-align: left;">258.302.000</td>
<td style="text-align: left;">39,1%</td>
<td style="text-align: left;">24,7%</td>
<td style="text-align: left;">18,8%</td>
<td style="text-align: left;">5.617.890.000</td>
<td style="text-align: left;">-1,02</td>
<td style="text-align: left;">0,48</td>
<td style="text-align: left;">3,42</td>
<td style="text-align: left;">5,43</td>
<td style="text-align: left;">8,65</td>
<td style="text-align: left;">2,23</td>
<td style="text-align: left;">11.159.900.000</td>
<td style="text-align: left;">1,34</td>
<td style="text-align: left;">18.607.100.000</td>
<td style="text-align: left;">4.400.410.000</td>
<td style="text-align: left;">25,8%</td>
<td style="text-align: left;">11,1%</td>
<td style="text-align: left;">Madeira e Papel</td>
<td style="text-align: left;">Papel e Celulose</td>
<td style="text-align: left;">45.780.200.000</td>
<td style="text-align: left;">24.898.500.000</td>
<td style="text-align: left;">9,93</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPFE3</td>
<td style="text-align: left;">72.445.000.000</td>
<td style="text-align: left;">16.629.000.000</td>
<td style="text-align: left;">10,1%</td>
<td style="text-align: left;">5.275.610.000</td>
<td style="text-align: left;">1,38</td>
<td style="text-align: left;">24.673.100.000</td>
<td style="text-align: left;">19.397.500.000</td>
<td style="text-align: left;">8,3%</td>
<td style="text-align: left;">14,6%</td>
<td style="text-align: left;">10.589.900.000</td>
<td style="text-align: left;">2.536.300.000</td>
<td style="text-align: left;">5,63</td>
<td style="text-align: left;">4,79</td>
<td style="text-align: left;">0,55</td>
<td style="text-align: left;">0,91</td>
<td style="text-align: left;">4,80</td>
<td style="text-align: left;">5.527.900.000</td>
<td style="text-align: left;">1.188.890.000</td>
<td style="text-align: left;">32,3%</td>
<td style="text-align: left;">26,5%</td>
<td style="text-align: left;">14,2%</td>
<td style="text-align: left;">1.152.250.000</td>
<td style="text-align: left;">-1,09</td>
<td style="text-align: left;">0,56</td>
<td style="text-align: left;">-25,30</td>
<td style="text-align: left;">3,80</td>
<td style="text-align: left;">7,28</td>
<td style="text-align: left;">2,26</td>
<td style="text-align: left;">17.831.400.000</td>
<td style="text-align: left;">1,01</td>
<td style="text-align: left;">39.970.600.000</td>
<td style="text-align: left;">9.388.920.000</td>
<td style="text-align: left;">31,0%</td>
<td style="text-align: left;">16,5%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">59.645.700.000</td>
<td style="text-align: left;">40.248.300.000</td>
<td style="text-align: left;">15,48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VAMO3</td>
<td style="text-align: left;">19.219.200.000</td>
<td style="text-align: left;">5.600.510.000</td>
<td style="text-align: left;">63,6%</td>
<td style="text-align: left;">1.663.400.000</td>
<td style="text-align: left;">2,13</td>
<td style="text-align: left;">10.415.300.000</td>
<td style="text-align: left;">8.751.900.000</td>
<td style="text-align: left;">2,9%</td>
<td style="text-align: left;">10,9%</td>
<td style="text-align: left;">2.096.690.000</td>
<td style="text-align: left;">548.818.000</td>
<td style="text-align: left;">8,89</td>
<td style="text-align: left;">7,16</td>
<td style="text-align: left;">0,31</td>
<td style="text-align: left;">2,03</td>
<td style="text-align: left;">0,58</td>
<td style="text-align: left;">645.802.000</td>
<td style="text-align: left;">115.800.000</td>
<td style="text-align: left;">44,4%</td>
<td style="text-align: left;">34,8%</td>
<td style="text-align: left;">10,7%</td>
<td style="text-align: left;">1.104.320.000</td>
<td style="text-align: left;">-1,13</td>
<td style="text-align: left;">0,51</td>
<td style="text-align: left;">3,48</td>
<td style="text-align: left;">4,71</td>
<td style="text-align: left;">15,30</td>
<td style="text-align: left;">2,03</td>
<td style="text-align: left;">4.878.780.000</td>
<td style="text-align: left;">1,64</td>
<td style="text-align: left;">6.024.180.000</td>
<td style="text-align: left;">1.481.510.000</td>
<td style="text-align: left;">13,2%</td>
<td style="text-align: left;">12,6%</td>
<td style="text-align: left;">Diversos</td>
<td style="text-align: left;">Aluguel de carros</td>
<td style="text-align: left;">18.635.600.000</td>
<td style="text-align: left;">9.883.710.000</td>
<td style="text-align: left;">4,42</td>
</tr>
<tr class="even">
<td style="text-align: left;">USIM5</td>
<td style="text-align: left;">40.205.300.000</td>
<td style="text-align: left;">18.886.200.000</td>
<td style="text-align: left;">24,3%</td>
<td style="text-align: left;">5.720.300.000</td>
<td style="text-align: left;">0,26</td>
<td style="text-align: left;">6.068.700.000</td>
<td style="text-align: left;">348.399.000</td>
<td style="text-align: left;">4,8%</td>
<td style="text-align: left;">3,2%</td>
<td style="text-align: left;">1.290.180.000</td>
<td style="text-align: left;">-101.270.000</td>
<td style="text-align: left;">6,89</td>
<td style="text-align: left;">3,87</td>
<td style="text-align: left;">0,71</td>
<td style="text-align: left;">3,43</td>
<td style="text-align: left;">-0,37</td>
<td style="text-align: left;">-465.771.000</td>
<td style="text-align: left;">-211.976.000</td>
<td style="text-align: left;">8,5%</td>
<td style="text-align: left;">4,5%</td>
<td style="text-align: left;">-0,6%</td>
<td style="text-align: left;">1.253.080.000</td>
<td style="text-align: left;">1,79</td>
<td style="text-align: left;">0,21</td>
<td style="text-align: left;">0,64</td>
<td style="text-align: left;">6,62</td>
<td style="text-align: left;">-18,35</td>
<td style="text-align: left;">0,36</td>
<td style="text-align: left;">23.446.300.000</td>
<td style="text-align: left;">0,30</td>
<td style="text-align: left;">28.516.800.000</td>
<td style="text-align: left;">6.714.210.000</td>
<td style="text-align: left;">-2,0%</td>
<td style="text-align: left;">4,0%</td>
<td style="text-align: left;">Siderurgia e Metalurgia</td>
<td style="text-align: left;">Siderurgia</td>
<td style="text-align: left;">8.894.400.000</td>
<td style="text-align: left;">8.546.000.000</td>
<td style="text-align: left;">18,71</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GOLL4</td>
<td style="text-align: left;">17.191.400.000</td>
<td style="text-align: left;">3.539.100.000</td>
<td style="text-align: left;">12,1%</td>
<td style="text-align: left;">904.929.000</td>
<td style="text-align: left;">-0,47</td>
<td style="text-align: left;">10.419.400.000</td>
<td style="text-align: left;">9.514.450.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">12,3%</td>
<td style="text-align: left;">2.106.980.000</td>
<td style="text-align: left;">721.265.000</td>
<td style="text-align: left;">6,14</td>
<td style="text-align: left;">3,40</td>
<td style="text-align: left;">1,07</td>
<td style="text-align: left;">0,25</td>
<td style="text-align: left;">0,25</td>
<td style="text-align: left;">106.357.000</td>
<td style="text-align: left;">-1.300.370.000</td>
<td style="text-align: left;">29,0%</td>
<td style="text-align: left;">11,4%</td>
<td style="text-align: left;">0,6%</td>
<td style="text-align: left;">418.739.000</td>
<td style="text-align: left;">-0,10</td>
<td style="text-align: left;">0,20</td>
<td style="text-align: left;">-0,33</td>
<td style="text-align: left;">1,62</td>
<td style="text-align: left;">32,13</td>
<td style="text-align: left;">-0,16</td>
<td style="text-align: left;">-22.029.000.000</td>
<td style="text-align: left;">0,19</td>
<td style="text-align: left;">18.458.200.000</td>
<td style="text-align: left;">4.665.450.000</td>
<td style="text-align: left;">-0,5%</td>
<td style="text-align: left;">14,9%</td>
<td style="text-align: left;">Transporte</td>
<td style="text-align: left;">Transporte Aéreo</td>
<td style="text-align: left;">12.931.400.000</td>
<td style="text-align: left;">3.416.910.000</td>
<td style="text-align: left;">-52,61</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPLE6</td>
<td style="text-align: left;">54.007.100.000</td>
<td style="text-align: left;">11.108.500.000</td>
<td style="text-align: left;">10,8%</td>
<td style="text-align: left;">4.447.800.000</td>
<td style="text-align: left;">0,75</td>
<td style="text-align: left;">16.307.700.000</td>
<td style="text-align: left;">11.859.900.000</td>
<td style="text-align: left;">7,6%</td>
<td style="text-align: left;">6,9%</td>
<td style="text-align: left;">3.738.590.000</td>
<td style="text-align: left;">774.783.000</td>
<td style="text-align: left;">10,23</td>
<td style="text-align: left;">7,48</td>
<td style="text-align: left;">0,41</td>
<td style="text-align: left;">1,47</td>
<td style="text-align: left;">0,65</td>
<td style="text-align: left;">1.928.570.000</td>
<td style="text-align: left;">317.792.000</td>
<td style="text-align: left;">21,6%</td>
<td style="text-align: left;">17,0%</td>
<td style="text-align: left;">8,9%</td>
<td style="text-align: left;">2.982.810.000</td>
<td style="text-align: left;">-1,26</td>
<td style="text-align: left;">0,49</td>
<td style="text-align: left;">7,45</td>
<td style="text-align: left;">7,05</td>
<td style="text-align: left;">13,67</td>
<td style="text-align: left;">1,21</td>
<td style="text-align: left;">21.760.800.000</td>
<td style="text-align: left;">1,20</td>
<td style="text-align: left;">21.971.800.000</td>
<td style="text-align: left;">5.359.730.000</td>
<td style="text-align: left;">8,9%</td>
<td style="text-align: left;">7,9%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">38.228.000.000</td>
<td style="text-align: left;">26.368.000.000</td>
<td style="text-align: left;">7,30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CIEL3</td>
<td style="text-align: left;">96.936.000.000</td>
<td style="text-align: left;">85.746.300.000</td>
<td style="text-align: left;">-4,3%</td>
<td style="text-align: left;">858.056.000</td>
<td style="text-align: left;">0,54</td>
<td style="text-align: left;">6.414.380.000</td>
<td style="text-align: left;">5.556.320.000</td>
<td style="text-align: left;">7,9%</td>
<td style="text-align: left;">1,6%</td>
<td style="text-align: left;">1.555.240.000</td>
<td style="text-align: left;">801.613.000</td>
<td style="text-align: left;">9,95</td>
<td style="text-align: left;">7,61</td>
<td style="text-align: left;">0,07</td>
<td style="text-align: left;">1,17</td>
<td style="text-align: left;">0,77</td>
<td style="text-align: left;">2.092.280.000</td>
<td style="text-align: left;">456.783.000</td>
<td style="text-align: left;">48,3%</td>
<td style="text-align: left;">23,7%</td>
<td style="text-align: left;">31,9%</td>
<td style="text-align: left;">2.716.820.000</td>
<td style="text-align: left;">2,75</td>
<td style="text-align: left;">0,10</td>
<td style="text-align: left;">0,80</td>
<td style="text-align: left;">6,38</td>
<td style="text-align: left;">4,74</td>
<td style="text-align: left;">0,83</td>
<td style="text-align: left;">11.970.700.000</td>
<td style="text-align: left;">1,51</td>
<td style="text-align: left;">6.563.200.000</td>
<td style="text-align: left;">2.619.010.000</td>
<td style="text-align: left;">17,5%</td>
<td style="text-align: left;">5,3%</td>
<td style="text-align: left;">Serviços Financeiros Diversos</td>
<td style="text-align: left;">Serviços Financeiros Diversos</td>
<td style="text-align: left;">15.472.700.000</td>
<td style="text-align: left;">9.916.380.000</td>
<td style="text-align: left;">4,41</td>
</tr>
<tr class="even">
<td style="text-align: left;">CVCB3</td>
<td style="text-align: left;">4.025.370.000</td>
<td style="text-align: left;">2.214.920.000</td>
<td style="text-align: left;">-4,3%</td>
<td style="text-align: left;">365.980.000</td>
<td style="text-align: left;">1,73</td>
<td style="text-align: left;">756.601.000</td>
<td style="text-align: left;">390.621.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">-0,1%</td>
<td style="text-align: left;">-5.778.020</td>
<td style="text-align: left;">90.424.000</td>
<td style="text-align: left;">-294,25</td>
<td style="text-align: left;">8,32</td>
<td style="text-align: left;">0,31</td>
<td style="text-align: left;">0,84</td>
<td style="text-align: left;">-1,08</td>
<td style="text-align: left;">-479.179.000</td>
<td style="text-align: left;">-87.504.000</td>
<td style="text-align: left;">100,0%</td>
<td style="text-align: left;">-0,5%</td>
<td style="text-align: left;">-38,0%</td>
<td style="text-align: left;">443.914.000</td>
<td style="text-align: left;">-0,95</td>
<td style="text-align: left;">0,33</td>
<td style="text-align: left;">-3,17</td>
<td style="text-align: left;">-226,64</td>
<td style="text-align: left;">-2,73</td>
<td style="text-align: left;">3,00</td>
<td style="text-align: left;">436.424.000</td>
<td style="text-align: left;">1,04</td>
<td style="text-align: left;">1.262.050.000</td>
<td style="text-align: left;">375.838.000</td>
<td style="text-align: left;">-109,8%</td>
<td style="text-align: left;">-0,2%</td>
<td style="text-align: left;">Viagens e Lazer</td>
<td style="text-align: left;">Viagens e Turismo</td>
<td style="text-align: left;">1.700.170.000</td>
<td style="text-align: left;">1.309.550.000</td>
<td style="text-align: left;">0,98</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VALE3</td>
<td style="text-align: left;">445.621.000.000</td>
<td style="text-align: left;">73.474.000.000</td>
<td style="text-align: left;">10,7%</td>
<td style="text-align: left;">20.168.000.000</td>
<td style="text-align: left;">0,37</td>
<td style="text-align: left;">70.289.000.000</td>
<td style="text-align: left;">50.121.000.000</td>
<td style="text-align: left;">5,7%</td>
<td style="text-align: left;">17,9%</td>
<td style="text-align: left;">79.954.000.000</td>
<td style="text-align: left;">20.379.000.000</td>
<td style="text-align: left;">4,69</td>
<td style="text-align: left;">3,91</td>
<td style="text-align: left;">0,46</td>
<td style="text-align: left;">1,08</td>
<td style="text-align: left;">10,47</td>
<td style="text-align: left;">47.517.000.000</td>
<td style="text-align: left;">13.864.000.000</td>
<td style="text-align: left;">40,1%</td>
<td style="text-align: left;">38,8%</td>
<td style="text-align: left;">23,3%</td>
<td style="text-align: left;">4.539.010.000</td>
<td style="text-align: left;">-1,86</td>
<td style="text-align: left;">0,73</td>
<td style="text-align: left;">62,99</td>
<td style="text-align: left;">4,06</td>
<td style="text-align: left;">6,83</td>
<td style="text-align: left;">1,71</td>
<td style="text-align: left;">190.172.000.000</td>
<td style="text-align: left;">1,57</td>
<td style="text-align: left;">206.296.000.000</td>
<td style="text-align: left;">51.962.000.000</td>
<td style="text-align: left;">25,0%</td>
<td style="text-align: left;">20,1%</td>
<td style="text-align: left;">Mineração</td>
<td style="text-align: left;">Minerais Metálicos</td>
<td style="text-align: left;">374.660.000.000</td>
<td style="text-align: left;">324.539.000.000</td>
<td style="text-align: left;">41,90</td>
</tr>
<tr class="even">
<td style="text-align: left;">VIVT3</td>
<td style="text-align: left;">119.991.000.000</td>
<td style="text-align: left;">19.401.300.000</td>
<td style="text-align: left;">3,9%</td>
<td style="text-align: left;">4.556.630.000</td>
<td style="text-align: left;">0,26</td>
<td style="text-align: left;">17.754.400.000</td>
<td style="text-align: left;">13.197.800.000</td>
<td style="text-align: left;">5,5%</td>
<td style="text-align: left;">5,9%</td>
<td style="text-align: left;">7.058.110.000</td>
<td style="text-align: left;">1.847.530.000</td>
<td style="text-align: left;">13,00</td>
<td style="text-align: left;">4,54</td>
<td style="text-align: left;">0,43</td>
<td style="text-align: left;">0,92</td>
<td style="text-align: left;">2,74</td>
<td style="text-align: left;">4.555.080.000</td>
<td style="text-align: left;">1.471.540.000</td>
<td style="text-align: left;">43,5%</td>
<td style="text-align: left;">13,8%</td>
<td style="text-align: left;">8,9%</td>
<td style="text-align: left;">1.663.560.000</td>
<td style="text-align: left;">-2,51</td>
<td style="text-align: left;">0,65</td>
<td style="text-align: left;">-47,83</td>
<td style="text-align: left;">11,13</td>
<td style="text-align: left;">17,25</td>
<td style="text-align: left;">1,13</td>
<td style="text-align: left;">69.269.900.000</td>
<td style="text-align: left;">1,53</td>
<td style="text-align: left;">51.224.700.000</td>
<td style="text-align: left;">13.111.800.000</td>
<td style="text-align: left;">6,6%</td>
<td style="text-align: left;">6,6%</td>
<td style="text-align: left;">Telecomunicações</td>
<td style="text-align: left;">Telecomunicações</td>
<td style="text-align: left;">91.751.000.000</td>
<td style="text-align: left;">78.553.200.000</td>
<td style="text-align: left;">41,64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B3SA3</td>
<td style="text-align: left;">47.177.000.000</td>
<td style="text-align: left;">16.141.900.000</td>
<td style="text-align: left;">18,0%</td>
<td style="text-align: left;">14.262.700.000</td>
<td style="text-align: left;">0,56</td>
<td style="text-align: left;">11.428.300.000</td>
<td style="text-align: left;">-2.834.400.000</td>
<td style="text-align: left;">3,4%</td>
<td style="text-align: left;">11,6%</td>
<td style="text-align: left;">5.473.700.000</td>
<td style="text-align: left;">1.371.260.000</td>
<td style="text-align: left;">12,49</td>
<td style="text-align: left;">10,49</td>
<td style="text-align: left;">0,22</td>
<td style="text-align: left;">1,62</td>
<td style="text-align: left;">0,72</td>
<td style="text-align: left;">4.175.070.000</td>
<td style="text-align: left;">1.052.790.000</td>
<td style="text-align: left;">85,6%</td>
<td style="text-align: left;">52,0%</td>
<td style="text-align: left;">39,7%</td>
<td style="text-align: left;">5.819.000.000</td>
<td style="text-align: left;">-6,79</td>
<td style="text-align: left;">1,51</td>
<td style="text-align: left;">11,50</td>
<td style="text-align: left;">13,01</td>
<td style="text-align: left;">17,06</td>
<td style="text-align: left;">3,47</td>
<td style="text-align: left;">20.540.800.000</td>
<td style="text-align: left;">6,77</td>
<td style="text-align: left;">10.522.000.000</td>
<td style="text-align: left;">2.477.120.000</td>
<td style="text-align: left;">20,3%</td>
<td style="text-align: left;">16,7%</td>
<td style="text-align: left;">Serviços Financeiros Diversos</td>
<td style="text-align: left;">Serviços Financeiros Diversos</td>
<td style="text-align: left;">68.390.200.000</td>
<td style="text-align: left;">71.224.600.000</td>
<td style="text-align: left;">3,53</td>
</tr>
<tr class="even">
<td style="text-align: left;">GGBR4</td>
<td style="text-align: left;">76.410.400.000</td>
<td style="text-align: left;">30.891.800.000</td>
<td style="text-align: left;">21,0%</td>
<td style="text-align: left;">6.002.670.000</td>
<td style="text-align: left;">0,23</td>
<td style="text-align: left;">11.478.100.000</td>
<td style="text-align: left;">5.475.410.000</td>
<td style="text-align: left;">14,0%</td>
<td style="text-align: left;">13,6%</td>
<td style="text-align: left;">10.366.500.000</td>
<td style="text-align: left;">2.253.810.000</td>
<td style="text-align: left;">4,45</td>
<td style="text-align: left;">3,43</td>
<td style="text-align: left;">0,94</td>
<td style="text-align: left;">2,93</td>
<td style="text-align: left;">4,63</td>
<td style="text-align: left;">8.131.230.000</td>
<td style="text-align: left;">1.581.790.000</td>
<td style="text-align: left;">17,5%</td>
<td style="text-align: left;">14,4%</td>
<td style="text-align: left;">11,3%</td>
<td style="text-align: left;">1.757.070.000</td>
<td style="text-align: left;">7,71</td>
<td style="text-align: left;">0,53</td>
<td style="text-align: left;">2,00</td>
<td style="text-align: left;">3,92</td>
<td style="text-align: left;">5,00</td>
<td style="text-align: left;">0,80</td>
<td style="text-align: left;">50.600.900.000</td>
<td style="text-align: left;">0,56</td>
<td style="text-align: left;">72.165.000.000</td>
<td style="text-align: left;">17.063.300.000</td>
<td style="text-align: left;">16,1%</td>
<td style="text-align: left;">16,0%</td>
<td style="text-align: left;">Siderurgia e Metalurgia</td>
<td style="text-align: left;">Siderurgia</td>
<td style="text-align: left;">46.098.800.000</td>
<td style="text-align: left;">40.623.400.000</td>
<td style="text-align: left;">28,80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ELET3</td>
<td style="text-align: left;">263.464.000.000</td>
<td style="text-align: left;">43.749.200.000</td>
<td style="text-align: left;">17,1%</td>
<td style="text-align: left;">20.193.500.000</td>
<td style="text-align: left;">0,51</td>
<td style="text-align: left;">57.369.400.000</td>
<td style="text-align: left;">37.175.900.000</td>
<td style="text-align: left;">0,6%</td>
<td style="text-align: left;">3,3%</td>
<td style="text-align: left;">8.704.280.000</td>
<td style="text-align: left;">4.993.900.000</td>
<td style="text-align: left;">14,10</td>
<td style="text-align: left;">10,07</td>
<td style="text-align: left;">0,13</td>
<td style="text-align: left;">1,47</td>
<td style="text-align: left;">0,74</td>
<td style="text-align: left;">1.703.340.000</td>
<td style="text-align: left;">1.685.230.000</td>
<td style="text-align: left;">49,6%</td>
<td style="text-align: left;">25,2%</td>
<td style="text-align: left;">4,5%</td>
<td style="text-align: left;">2.307.100.000</td>
<td style="text-align: left;">-0,79</td>
<td style="text-align: left;">0,32</td>
<td style="text-align: left;">6,15</td>
<td style="text-align: left;">9,83</td>
<td style="text-align: left;">50,24</td>
<td style="text-align: left;">0,77</td>
<td style="text-align: left;">111.402.000.000</td>
<td style="text-align: left;">2,48</td>
<td style="text-align: left;">34.492.200.000</td>
<td style="text-align: left;">9.245.530.000</td>
<td style="text-align: left;">1,5%</td>
<td style="text-align: left;">3,6%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">122.746.000.000</td>
<td style="text-align: left;">85.570.300.000</td>
<td style="text-align: left;">48,29</td>
</tr>
<tr class="even">
<td style="text-align: left;">RENT3</td>
<td style="text-align: left;">71.955.900.000</td>
<td style="text-align: left;">16.764.900.000</td>
<td style="text-align: left;">24,6%</td>
<td style="text-align: left;">9.730.360.000</td>
<td style="text-align: left;">1,48</td>
<td style="text-align: left;">36.851.600.000</td>
<td style="text-align: left;">27.121.200.000</td>
<td style="text-align: left;">2,7%</td>
<td style="text-align: left;">7,1%</td>
<td style="text-align: left;">5.097.250.000</td>
<td style="text-align: left;">806.666.000</td>
<td style="text-align: left;">16,56</td>
<td style="text-align: left;">9,12</td>
<td style="text-align: left;">0,36</td>
<td style="text-align: left;">1,24</td>
<td style="text-align: left;">1,23</td>
<td style="text-align: left;">1.304.290.000</td>
<td style="text-align: left;">-88.069.000</td>
<td style="text-align: left;">30,0%</td>
<td style="text-align: left;">19,8%</td>
<td style="text-align: left;">5,1%</td>
<td style="text-align: left;">1.060.360.000</td>
<td style="text-align: left;">-1,89</td>
<td style="text-align: left;">0,80</td>
<td style="text-align: left;">17,66</td>
<td style="text-align: left;">11,24</td>
<td style="text-align: left;">43,91</td>
<td style="text-align: left;">2,30</td>
<td style="text-align: left;">24.880.200.000</td>
<td style="text-align: left;">2,23</td>
<td style="text-align: left;">25.694.300.000</td>
<td style="text-align: left;">6.846.160.000</td>
<td style="text-align: left;">5,2%</td>
<td style="text-align: left;">8,8%</td>
<td style="text-align: left;">Diversos</td>
<td style="text-align: left;">Aluguel de carros</td>
<td style="text-align: left;">84.391.300.000</td>
<td style="text-align: left;">57.270.100.000</td>
<td style="text-align: left;">23,46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GOAU4</td>
<td style="text-align: left;">77.423.600.000</td>
<td style="text-align: left;">31.899.900.000</td>
<td style="text-align: left;">21,0%</td>
<td style="text-align: left;">6.979.870.000</td>
<td style="text-align: left;">0,64</td>
<td style="text-align: left;">11.478.100.000</td>
<td style="text-align: left;">4.498.200.000</td>
<td style="text-align: left;">10,7%</td>
<td style="text-align: left;">13,4%</td>
<td style="text-align: left;">10.350.900.000</td>
<td style="text-align: left;">2.250.270.000</td>
<td style="text-align: left;">1,52</td>
<td style="text-align: left;">1,17</td>
<td style="text-align: left;">0,93</td>
<td style="text-align: left;">3,02</td>
<td style="text-align: left;">2,65</td>
<td style="text-align: left;">2.744.540.000</td>
<td style="text-align: left;">550.676.000</td>
<td style="text-align: left;">17,5%</td>
<td style="text-align: left;">14,3%</td>
<td style="text-align: left;">11,3%</td>
<td style="text-align: left;">1.033.840.000</td>
<td style="text-align: left;">1,79</td>
<td style="text-align: left;">0,15</td>
<td style="text-align: left;">0,53</td>
<td style="text-align: left;">1,09</td>
<td style="text-align: left;">4,10</td>
<td style="text-align: left;">0,63</td>
<td style="text-align: left;">17.948.100.000</td>
<td style="text-align: left;">0,16</td>
<td style="text-align: left;">72.165.000.000</td>
<td style="text-align: left;">17.063.300.000</td>
<td style="text-align: left;">15,3%</td>
<td style="text-align: left;">16,0%</td>
<td style="text-align: left;">Siderurgia e Metalurgia</td>
<td style="text-align: left;">Siderurgia</td>
<td style="text-align: left;">15.746.400.000</td>
<td style="text-align: left;">11.248.200.000</td>
<td style="text-align: left;">17,36</td>
</tr>
<tr class="even">
<td style="text-align: left;">PCAR3</td>
<td style="text-align: left;">22.685.000.000</td>
<td style="text-align: left;">7.936.000.000</td>
<td style="text-align: left;">-60,5%</td>
<td style="text-align: left;">3.740.000.000</td>
<td style="text-align: left;">1,21</td>
<td style="text-align: left;">6.051.000.000</td>
<td style="text-align: left;">2.311.000.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">-1,2%</td>
<td style="text-align: left;">-279.000.000</td>
<td style="text-align: left;">291.000.000</td>
<td style="text-align: left;">-11,97</td>
<td style="text-align: left;">14,85</td>
<td style="text-align: left;">0,03</td>
<td style="text-align: left;">1,32</td>
<td style="text-align: left;">-11,36</td>
<td style="text-align: left;">-3.070.000.000</td>
<td style="text-align: left;">-1.295.000.000</td>
<td style="text-align: left;">-5,9%</td>
<td style="text-align: left;">-41,2%</td>
<td style="text-align: left;">-426,8%</td>
<td style="text-align: left;">270.139.000</td>
<td style="text-align: left;">-0,11</td>
<td style="text-align: left;">0,05</td>
<td style="text-align: left;">0,54</td>
<td style="text-align: left;">-3,69</td>
<td style="text-align: left;">-0,34</td>
<td style="text-align: left;">0,21</td>
<td style="text-align: left;">5.016.000.000</td>
<td style="text-align: left;">1,52</td>
<td style="text-align: left;">678.001.000</td>
<td style="text-align: left;">4.742.000.000</td>
<td style="text-align: left;">-61,2%</td>
<td style="text-align: left;">-1,7%</td>
<td style="text-align: left;">Comércio e Distribuição</td>
<td style="text-align: left;">Alimentos</td>
<td style="text-align: left;">3.340.230.000</td>
<td style="text-align: left;">1.029.230.000</td>
<td style="text-align: left;">18,57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MGLU3</td>
<td style="text-align: left;">35.598.900.000</td>
<td style="text-align: left;">19.085.500.000</td>
<td style="text-align: left;">23,0%</td>
<td style="text-align: left;">2.486.800.000</td>
<td style="text-align: left;">0,72</td>
<td style="text-align: left;">7.231.730.000</td>
<td style="text-align: left;">4.744.920.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">3,1%</td>
<td style="text-align: left;">1.108.990.000</td>
<td style="text-align: left;">226.004.000</td>
<td style="text-align: left;">12,98</td>
<td style="text-align: left;">6,09</td>
<td style="text-align: left;">1,06</td>
<td style="text-align: left;">1,25</td>
<td style="text-align: left;">-0,13</td>
<td style="text-align: left;">-895.639.000</td>
<td style="text-align: left;">-301.746.000</td>
<td style="text-align: left;">27,9%</td>
<td style="text-align: left;">2,9%</td>
<td style="text-align: left;">-2,4%</td>
<td style="text-align: left;">6.748.930.000</td>
<td style="text-align: left;">-1,48</td>
<td style="text-align: left;">0,27</td>
<td style="text-align: left;">2,52</td>
<td style="text-align: left;">8,70</td>
<td style="text-align: left;">-10,78</td>
<td style="text-align: left;">0,96</td>
<td style="text-align: left;">10.011.500.000</td>
<td style="text-align: left;">0,26</td>
<td style="text-align: left;">37.614.000.000</td>
<td style="text-align: left;">8.572.260.000</td>
<td style="text-align: left;">-8,9%</td>
<td style="text-align: left;">4,4%</td>
<td style="text-align: left;">Comércio</td>
<td style="text-align: left;">Eletrodomésticos</td>
<td style="text-align: left;">14.395.900.000</td>
<td style="text-align: left;">9.650.970.000</td>
<td style="text-align: left;">1,48</td>
</tr>
<tr class="even">
<td style="text-align: left;">JBSS3</td>
<td style="text-align: left;">198.343.000.000</td>
<td style="text-align: left;">72.247.700.000</td>
<td style="text-align: left;">19,4%</td>
<td style="text-align: left;">13.548.700.000</td>
<td style="text-align: left;">2,21</td>
<td style="text-align: left;">93.799.000.000</td>
<td style="text-align: left;">80.250.300.000</td>
<td style="text-align: left;">9,4%</td>
<td style="text-align: left;">-25,4%</td>
<td style="text-align: left;">-50.307.400.000</td>
<td style="text-align: left;">1.679.420.000</td>
<td style="text-align: left;">-2,54</td>
<td style="text-align: left;">-3,19</td>
<td style="text-align: left;">1,85</td>
<td style="text-align: left;">1,43</td>
<td style="text-align: left;">2,10</td>
<td style="text-align: left;">4.647.070.000</td>
<td style="text-align: left;">-263.624.000</td>
<td style="text-align: left;">-4,1%</td>
<td style="text-align: left;">-13,7%</td>
<td style="text-align: left;">1,3%</td>
<td style="text-align: left;">2.218.120.000</td>
<td style="text-align: left;">-0,59</td>
<td style="text-align: left;">0,24</td>
<td style="text-align: left;">2,19</td>
<td style="text-align: left;">-0,94</td>
<td style="text-align: left;">10,18</td>
<td style="text-align: left;">1,12</td>
<td style="text-align: left;">42.355.300.000</td>
<td style="text-align: left;">0,13</td>
<td style="text-align: left;">367.860.000.000</td>
<td style="text-align: left;">89.382.600.000</td>
<td style="text-align: left;">11,0%</td>
<td style="text-align: left;">-32,1%</td>
<td style="text-align: left;">Alimentos Processados</td>
<td style="text-align: left;">Carnes e Derivados</td>
<td style="text-align: left;">127.541.000.000</td>
<td style="text-align: left;">47.290.200.000</td>
<td style="text-align: left;">19,10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HAPV3</td>
<td style="text-align: left;">75.034.400.000</td>
<td style="text-align: left;">9.179.330.000</td>
<td style="text-align: left;">51,6%</td>
<td style="text-align: left;">5.735.710.000</td>
<td style="text-align: left;">0,23</td>
<td style="text-align: left;">11.584.100.000</td>
<td style="text-align: left;">5.848.370.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">-0,5%</td>
<td style="text-align: left;">-409.071.000</td>
<td style="text-align: left;">24.775.100</td>
<td style="text-align: left;">-87,65</td>
<td style="text-align: left;">18,60</td>
<td style="text-align: left;">0,35</td>
<td style="text-align: left;">1,15</td>
<td style="text-align: left;">-0,10</td>
<td style="text-align: left;">-784.564.000</td>
<td style="text-align: left;">-160.871.000</td>
<td style="text-align: left;">24,0%</td>
<td style="text-align: left;">-1,6%</td>
<td style="text-align: left;">-3,0%</td>
<td style="text-align: left;">7.539.460.000</td>
<td style="text-align: left;">-1,82</td>
<td style="text-align: left;">0,40</td>
<td style="text-align: left;">24,59</td>
<td style="text-align: left;">-73,35</td>
<td style="text-align: left;">-38,25</td>
<td style="text-align: left;">0,61</td>
<td style="text-align: left;">49.333.000.000</td>
<td style="text-align: left;">1,14</td>
<td style="text-align: left;">26.389.700.000</td>
<td style="text-align: left;">6.839.820.000</td>
<td style="text-align: left;">-1,6%</td>
<td style="text-align: left;">-0,6%</td>
<td style="text-align: left;">Serv.Méd.Hospit. Análises e Diagnósticos</td>
<td style="text-align: left;">Serv.Méd.Hospit. Análises e Diagnósticos</td>
<td style="text-align: left;">35.855.400.000</td>
<td style="text-align: left;">30.007.100.000</td>
<td style="text-align: left;">6,54</td>
</tr>
<tr class="even">
<td style="text-align: left;">CCRO3</td>
<td style="text-align: left;">52.912.200.000</td>
<td style="text-align: left;">11.316.200.000</td>
<td style="text-align: left;">17,2%</td>
<td style="text-align: left;">7.604.250.000</td>
<td style="text-align: left;">2,39</td>
<td style="text-align: left;">30.258.900.000</td>
<td style="text-align: left;">22.654.700.000</td>
<td style="text-align: left;">1,6%</td>
<td style="text-align: left;">10,3%</td>
<td style="text-align: left;">5.430.180.000</td>
<td style="text-align: left;">1.198.880.000</td>
<td style="text-align: left;">8,72</td>
<td style="text-align: left;">6,94</td>
<td style="text-align: left;">0,31</td>
<td style="text-align: left;">1,13</td>
<td style="text-align: left;">0,46</td>
<td style="text-align: left;">933.968.000</td>
<td style="text-align: left;">251.532.000</td>
<td style="text-align: left;">42,9%</td>
<td style="text-align: left;">32,8%</td>
<td style="text-align: left;">5,9%</td>
<td style="text-align: left;">2.020.000.000</td>
<td style="text-align: left;">-0,87</td>
<td style="text-align: left;">0,47</td>
<td style="text-align: left;">19,12</td>
<td style="text-align: left;">4,55</td>
<td style="text-align: left;">26,43</td>
<td style="text-align: left;">1,95</td>
<td style="text-align: left;">12.677.100.000</td>
<td style="text-align: left;">1,49</td>
<td style="text-align: left;">16.567.700.000</td>
<td style="text-align: left;">4.426.170.000</td>
<td style="text-align: left;">7,4%</td>
<td style="text-align: left;">12,2%</td>
<td style="text-align: left;">Transporte</td>
<td style="text-align: left;">Exploração de Rodovias</td>
<td style="text-align: left;">47.339.100.000</td>
<td style="text-align: left;">24.684.400.000</td>
<td style="text-align: left;">6,28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TIMS3</td>
<td style="text-align: left;">55.973.000.000</td>
<td style="text-align: left;">10.836.800.000</td>
<td style="text-align: left;">11,2%</td>
<td style="text-align: left;">4.446.240.000</td>
<td style="text-align: left;">0,19</td>
<td style="text-align: left;">4.837.070.000</td>
<td style="text-align: left;">390.829.000</td>
<td style="text-align: left;">5,1%</td>
<td style="text-align: left;">7,9%</td>
<td style="text-align: left;">4.429.490.000</td>
<td style="text-align: left;">1.339.750.000</td>
<td style="text-align: left;">8,87</td>
<td style="text-align: left;">3,37</td>
<td style="text-align: left;">0,42</td>
<td style="text-align: left;">0,79</td>
<td style="text-align: left;">0,95</td>
<td style="text-align: left;">2.293.100.000</td>
<td style="text-align: left;">716.005.000</td>
<td style="text-align: left;">51,0%</td>
<td style="text-align: left;">18,9%</td>
<td style="text-align: left;">9,8%</td>
<td style="text-align: left;">2.420.800.000</td>
<td style="text-align: left;">-1,99</td>
<td style="text-align: left;">0,70</td>
<td style="text-align: left;">-13,50</td>
<td style="text-align: left;">8,78</td>
<td style="text-align: left;">16,96</td>
<td style="text-align: left;">1,52</td>
<td style="text-align: left;">25.574.100.000</td>
<td style="text-align: left;">1,66</td>
<td style="text-align: left;">23.383.100.000</td>
<td style="text-align: left;">6.055.320.000</td>
<td style="text-align: left;">9,0%</td>
<td style="text-align: left;">9,3%</td>
<td style="text-align: left;">Telecomunicações</td>
<td style="text-align: left;">Telecomunicações</td>
<td style="text-align: left;">39.293.200.000</td>
<td style="text-align: left;">38.902.300.000</td>
<td style="text-align: left;">10,56</td>
</tr>
<tr class="even">
<td style="text-align: left;">ENEV3</td>
<td style="text-align: left;">42.790.700.000</td>
<td style="text-align: left;">5.326.810.000</td>
<td style="text-align: left;">29,9%</td>
<td style="text-align: left;">1.686.680.000</td>
<td style="text-align: left;">1,41</td>
<td style="text-align: left;">18.263.000.000</td>
<td style="text-align: left;">16.576.300.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">4,6%</td>
<td style="text-align: left;">1.968.290.000</td>
<td style="text-align: left;">753.713.000</td>
<td style="text-align: left;">17,61</td>
<td style="text-align: left;">10,42</td>
<td style="text-align: left;">0,21</td>
<td style="text-align: left;">1,14</td>
<td style="text-align: left;">0,41</td>
<td style="text-align: left;">656.461.000</td>
<td style="text-align: left;">389.928.000</td>
<td style="text-align: left;">34,7%</td>
<td style="text-align: left;">21,9%</td>
<td style="text-align: left;">7,3%</td>
<td style="text-align: left;">1.584.450.000</td>
<td style="text-align: left;">-0,82</td>
<td style="text-align: left;">0,42</td>
<td style="text-align: left;">28,16</td>
<td style="text-align: left;">9,19</td>
<td style="text-align: left;">27,56</td>
<td style="text-align: left;">1,40</td>
<td style="text-align: left;">12.965.100.000</td>
<td style="text-align: left;">2,01</td>
<td style="text-align: left;">9.003.490.000</td>
<td style="text-align: left;">2.523.330.000</td>
<td style="text-align: left;">5,1%</td>
<td style="text-align: left;">5,0%</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: left;">34.670.700.000</td>
<td style="text-align: left;">18.094.400.000</td>
<td style="text-align: left;">8,18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PRIO3</td>
<td style="text-align: left;">28.521.700.000</td>
<td style="text-align: left;">5.086.530.000</td>
<td style="text-align: left;">74,0%</td>
<td style="text-align: left;">2.225.260.000</td>
<td style="text-align: left;">0,82</td>
<td style="text-align: left;">10.521.700.000</td>
<td style="text-align: left;">8.296.450.000</td>
<td style="text-align: left;">0,0%</td>
<td style="text-align: left;">19,8%</td>
<td style="text-align: left;">5.642.470.000</td>
<td style="text-align: left;">2.285.470.000</td>
<td style="text-align: left;">9,02</td>
<td style="text-align: left;">6,75</td>
<td style="text-align: left;">0,36</td>
<td style="text-align: left;">1,32</td>
<td style="text-align: left;">5,14</td>
<td style="text-align: left;">4.558.570.000</td>
<td style="text-align: left;">1.628.820.000</td>
<td style="text-align: left;">62,3%</td>
<td style="text-align: left;">55,6%</td>
<td style="text-align: left;">44,9%</td>
<td style="text-align: left;">887.229.000</td>
<td style="text-align: left;">-4,04</td>
<td style="text-align: left;">1,49</td>
<td style="text-align: left;">34,66</td>
<td style="text-align: left;">7,55</td>
<td style="text-align: left;">9,34</td>
<td style="text-align: left;">3,30</td>
<td style="text-align: left;">12.901.100.000</td>
<td style="text-align: left;">4,20</td>
<td style="text-align: left;">10.145.400.000</td>
<td style="text-align: left;">4.045.490.000</td>
<td style="text-align: left;">35,3%</td>
<td style="text-align: left;">22,0%</td>
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: left;">Exploração, Refino e Distribuição</td>
<td style="text-align: left;">50.892.300.000</td>
<td style="text-align: left;">42.595.900.000</td>
<td style="text-align: left;">14,54</td>
</tr>
<tr class="even">
<td style="text-align: left;">VBBR3</td>
<td style="text-align: left;">40.978.000.000</td>
<td style="text-align: left;">22.271.000.000</td>
<td style="text-align: left;">20,2%</td>
<td style="text-align: left;">6.436.000.000</td>
<td style="text-align: left;">1,18</td>
<td style="text-align: left;">16.003.000.000</td>
<td style="text-align: left;">9.567.000.000</td>
<td style="text-align: left;">4,0%</td>
<td style="text-align: left;">9,7%</td>
<td style="text-align: left;">3.956.000.000</td>
<td style="text-align: left;">2.136.000.000</td>
<td style="text-align: left;">8,45</td>
<td style="text-align: left;">7,42</td>
<td style="text-align: left;">4,01</td>
<td style="text-align: left;">2,31</td>
<td style="text-align: left;">1,75</td>
<td style="text-align: left;">2.035.000.000</td>
<td style="text-align: left;">1.255.000.000</td>
<td style="text-align: left;">4,6%</td>
<td style="text-align: left;">2,4%</td>
<td style="text-align: left;">1,2%</td>
<td style="text-align: left;">1.165.000.000</td>
<td style="text-align: left;">-4,63</td>
<td style="text-align: left;">0,58</td>
<td style="text-align: left;">1,89</td>
<td style="text-align: left;">6,03</td>
<td style="text-align: left;">11,73</td>
<td style="text-align: left;">1,76</td>
<td style="text-align: left;">13.555.000.000</td>
<td style="text-align: left;">0,15</td>
<td style="text-align: left;">164.361.000.000</td>
<td style="text-align: left;">43.063.000.000</td>
<td style="text-align: left;">15,0%</td>
<td style="text-align: left;">13,0%</td>
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: left;">Exploração, Refino e Distribuição</td>
<td style="text-align: left;">33.437.800.000</td>
<td style="text-align: left;">23.870.800.000</td>
<td style="text-align: left;">11,64</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Pronto! Consolidamos tudo em uma só tabela. Mas ainda não acabou! Vamos rodar um str nessa tabela para notar algo bem interessante:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   40 obs. of  40 variables:
 $ Ação                        : chr  "PETR4" "CMIG4" "CYRE3" "ARZZ3" ...
 $ Ativo                       : chr  "990.459.000.000" "54.543.100.000" "16.825.100.000" "5.435.060.000" ...
 $ Ativo Circulante            : chr  "136.816.000.000" "13.540.400.000" "8.840.340.000" "2.771.140.000" ...
 $ Cres. Rec (5a)              : chr  "19,4%" "11,8%" "12,2%" "35,7%" ...
 $ Disponibilidades            : chr  "60.985.000.000" "3.725.800.000" "2.883.690.000" "682.038.000" ...
 $ Div Br/ Patrim              : chr  "0,75" "0,50" "0,64" "0,37" ...
 $ Dív. Bruta                  : chr  "279.375.000.000" "11.831.000.000" "4.842.230.000" "1.028.030.000" ...
 $ Dív. Líquida                : chr  "218.390.000.000" "8.105.240.000" "1.958.540.000" "345.987.000" ...
 $ Div. Yield                  : chr  "26,1%" "8,7%" "2,6%" "2,7%" ...
 $ EBIT / Ativo                : chr  "26,4%" "14,5%" "4,6%" "9,0%" ...
 $ EBIT_ult_12_meses           : chr  "261.516.000.000" "7.899.710.000" "766.088.000" "487.797.000" ...
 $ EBIT_ult_3_meses            : chr  "49.813.000.000" "1.828.940.000" "253.043.000" "124.657.000" ...
 $ EV / EBIT                   : chr  "2,61" "4,56" "12,76" "13,95" ...
 $ EV / EBITDA                 : chr  "2,03" "3,95" "12,10" "9,87" ...
 $ Giro Ativos                 : chr  "0,59" "0,66" "0,35" "0,85" ...
 $ Liquidez Corr               : chr  "0,90" "1,34" "2,65" "1,63" ...
 $ LPA                         : chr  "11,99" "3,01" "2,35" "3,33" ...
 $ Lucro Líquido_ult_12_meses  : chr  "156.375.000.000" "6.627.360.000" "939.291.000" "369.973.000" ...
 $ Lucro Líquido_ult_3_meses   : chr  "28.782.000.000" "2.642.220.000" "279.385.000" "100.626.000" ...
 $ Marg. Bruta                 : chr  "50,6%" "23,8%" "32,2%" "53,4%" ...
 $ Marg. EBIT                  : chr  "45,0%" "22,0%" "13,1%" "10,6%" ...
 $ Marg. Líquida               : chr  "27,0%" "18,5%" "16,6%" "8,0%" ...
 $ Nro. Ações                  : chr  "13.044.500.000" "2.201.370.000" "399.743.000" "110.989.000" ...
 $ P/Ativ Circ Liq             : chr  "-0,96" "-1,61" "30,19" "45,56" ...
 $ P/Ativos                    : chr  "0,47" "0,51" "0,46" "1,19" ...
 $ P/Cap. Giro                 : chr  "-31,33" "8,18" "1,42" "6,05" ...
 $ P/EBIT                      : chr  "1,77" "3,53" "10,20" "13,24" ...
 $ P/L                         : chr  "2,96" "4,21" "8,32" "17,46" ...
 $ P/VP                        : chr  "1,25" "1,18" "1,04" "2,32" ...
 $ Patrim. Líq                 : chr  "370.683.000.000" "23.609.100.000" "7.519.980.000" "2.783.100.000" ...
 $ PSR                         : chr  "0,80" "0,78" "1,34" "1,40" ...
 $ Receita Líquida_ult_12_meses: chr  "581.563.000.000" "35.868.400.000" "5.847.040.000" "4.605.710.000" ...
 $ Receita Líquida_ult_3_meses : chr  "113.840.000.000" "8.819.520.000" "1.633.050.000" "1.131.020.000" ...
 $ ROE                         : chr  "42,2%" "28,1%" "12,5%" "13,3%" ...
 $ ROIC                        : chr  "29,0%" "16,3%" "5,6%" "11,4%" ...
 $ Setor                       : chr  "Petróleo, Gás e Biocombustíveis" "Energia Elétrica" "Construção Civil" "Comércio" ...
 $ Subsetor                    : chr  "Exploração, Refino e Distribuição" "Energia Elétrica" "Incorporações" "Tecidos, Vestuário e Calçados" ...
 $ Valor da firma              : chr  "681.600.000.000" "36.018.600.000" "9.773.520.000" "6.804.440.000" ...
 $ Valor de mercado            : chr  "463.210.000.000" "27.913.400.000" "7.814.980.000" "6.458.450.000" ...
 $ VPA                         : chr  "28,42" "10,72" "18,81" "25,08" ...</code></pre>
</div>
</div>
<p><strong><em>Você notou que todas as colunas estão no formato de texto?</em></strong></p>
<p>Então, esse será o nosso próximo desafio. Tratar cada uma das colunas no seu tipo de dados específico.</p>
</section>
</section>
</section>
<section id="ajustando-os-tipos-dos-dados" class="level2">
<h2 class="anchored" data-anchor-id="ajustando-os-tipos-dos-dados">Ajustando os tipos dos dados</h2>
<p>Nesta etapa, vamos tratar 3 tipos de dados para formatar a nossa tabela:</p>
<ol type="1">
<li>Dados financeiros ou inteiros</li>
<li>Dados adimensionais (indicadores)</li>
<li>Dados percentuais</li>
</ol>
<section id="dados-financeiros-ou-inteiros" class="level3">
<h3 class="anchored" data-anchor-id="dados-financeiros-ou-inteiros">1. Dados financeiros ou inteiros</h3>
<p>Vamos passar logo abaixo as colunas com valores financeiros ou inteiros de nossa base de dados (15 colunas).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vetor de nomes de colunas</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>colunas_valores_fin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ativo"</span>, <span class="st">"Ativo Circulante"</span>, <span class="st">"Disponibilidades"</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Dív. Bruta"</span>, <span class="st">"Dív. Líquida"</span>, <span class="st">"EBIT_ult_12_meses"</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"EBIT_ult_3_meses"</span>, <span class="st">"Lucro Líquido_ult_12_meses"</span>, </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Lucro Líquido_ult_3_meses"</span>, <span class="st">"Nro. Ações"</span>,<span class="st">"Patrim. Líq"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Receita Líquida_ult_12_meses"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Receita Líquida_ult_3_meses"</span>,<span class="st">"Valor da firma"</span>, </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Valor de mercado"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com as colunas referenciadas, vamos pedir suporte ao ChatGPT alterando apenas os dados financeiros e inteiros de nossa base.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que trate as colunas do data.frame “dados_completos” passadas pela variável “colunas_valores_fin” que está no formato de chr para float lendo todas essas colunas e fazendo a alteração por meio de um laço for. Lembre-se de inicialmente trocar onde tiver “.” por ““.</p>
</div>
</div>
<section id="código-11" class="level4">
<h4 class="anchored" data-anchor-id="código-11">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Substitua "." por "" e converta para float (numérico)</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (coluna <span class="cf">in</span> colunas_valores_fin) {</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  dados_completos[, coluna] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, dados_completos[,coluna]))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos testar se a conversão foi bem sucedida de acordo com código que geramos com o ChatGPT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testando se a conversão foi bem sucedida</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   40 obs. of  15 variables:
 $ Ativo                       : num  9.90e+11 5.45e+10 1.68e+10 5.44e+09 1.88e+10 ...
 $ Ativo Circulante            : num  1.37e+11 1.35e+10 8.84e+09 2.77e+09 3.60e+09 ...
 $ Disponibilidades            : num  6.10e+10 3.73e+09 2.88e+09 6.82e+08 1.32e+09 ...
 $ Dív. Bruta                  : num  2.79e+11 1.18e+10 4.84e+09 1.03e+09 9.43e+09 ...
 $ Dív. Líquida                : num  2.18e+11 8.11e+09 1.96e+09 3.46e+08 8.10e+09 ...
 $ EBIT_ult_12_meses           : num  2.62e+11 7.90e+09 7.66e+08 4.88e+08 1.48e+09 ...
 $ EBIT_ult_3_meses            : num  4.98e+10 1.83e+09 2.53e+08 1.25e+08 3.88e+08 ...
 $ Lucro Líquido_ult_12_meses  : num  1.56e+11 6.63e+09 9.39e+08 3.70e+08 1.17e+09 ...
 $ Lucro Líquido_ult_3_meses   : num  2.88e+10 2.64e+09 2.79e+08 1.01e+08 2.20e+08 ...
 $ Nro. Ações                  : num  1.30e+10 2.20e+09 4.00e+08 1.11e+08 1.03e+09 ...
 $ Patrim. Líq                 : num  3.71e+11 2.36e+10 7.52e+09 2.78e+09 6.69e+09 ...
 $ Receita Líquida_ult_12_meses: num  5.82e+11 3.59e+10 5.85e+09 4.61e+09 2.34e+09 ...
 $ Receita Líquida_ult_3_meses : num  1.14e+11 8.82e+09 1.63e+09 1.13e+09 6.79e+08 ...
 $ Valor da firma              : num  6.82e+11 3.60e+10 9.77e+09 6.80e+09 2.02e+10 ...
 $ Valor de mercado            : num  4.63e+11 2.79e+10 7.81e+09 6.46e+09 1.21e+10 ...</code></pre>
</div>
</div>
</section>
</section>
<section id="dados-adimensionais-indicadores" class="level3">
<h3 class="anchored" data-anchor-id="dados-adimensionais-indicadores">2. Dados adimensionais (indicadores)</h3>
<p>Vamos passar logo abaixo as colunas com os indicadores adimensionais de nossa base de dados (14 colunas).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vetor de nomes de colunas</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>colunas_indicadores <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Div Br/ Patrim"</span>, <span class="st">"EV / EBIT"</span>, <span class="st">"EV / EBITDA"</span>,<span class="st">"Giro Ativos"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Liquidez Corr"</span>, <span class="st">"LPA"</span>, <span class="st">"P/Ativ Circ Liq"</span>, <span class="st">"P/Ativos"</span>, </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"P/Cap. Giro"</span>, <span class="st">"P/EBIT"</span>, <span class="st">"P/L"</span>, <span class="st">"P/VP"</span>, <span class="st">"PSR"</span>, <span class="st">"VPA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com as colunas referenciadas, vamos pedir suporte ao ChatGPT alterando apenas os dados dos indicadores de nossa base.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que trate as colunas do data.frame “dados_completos” passadas pela variável “colunas_indicadores” que está no formato de chr para float lendo todas essas colunas e fazendo a alteração por meio de um laço for. Lembre-se de inicialmente trocar onde tiver “,” por “.”.</p>
</div>
</div>
<section id="código-12" class="level4">
<h4 class="anchored" data-anchor-id="código-12">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Substitua "," por "." e converta para float (numérico)</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (coluna <span class="cf">in</span> colunas_indicadores) {</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  dados_completos[[coluna]] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, dados_completos[[coluna]]))</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos testar se a conversão foi bem sucedida de acordo com código que geramos com o ChatGPT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testando se a conversão foi bem sucedida</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   40 obs. of  29 variables:
 $ Ativo                       : num  9.90e+11 5.45e+10 1.68e+10 5.44e+09 1.88e+10 ...
 $ Ativo Circulante            : num  1.37e+11 1.35e+10 8.84e+09 2.77e+09 3.60e+09 ...
 $ Disponibilidades            : num  6.10e+10 3.73e+09 2.88e+09 6.82e+08 1.32e+09 ...
 $ Div Br/ Patrim              : num  0.75 0.5 0.64 0.37 1.41 3.36 0.25 1.88 0.19 0.15 ...
 $ Dív. Bruta                  : num  2.79e+11 1.18e+10 4.84e+09 1.03e+09 9.43e+09 ...
 $ Dív. Líquida                : num  2.18e+11 8.11e+09 1.96e+09 3.46e+08 8.10e+09 ...
 $ EBIT_ult_12_meses           : num  2.62e+11 7.90e+09 7.66e+08 4.88e+08 1.48e+09 ...
 $ EBIT_ult_3_meses            : num  4.98e+10 1.83e+09 2.53e+08 1.25e+08 3.88e+08 ...
 $ EV / EBIT                   : num  2.61 4.56 12.76 13.95 13.66 ...
 $ EV / EBITDA                 : num  2.03 3.95 12.1 9.87 13.47 ...
 $ Giro Ativos                 : num  0.59 0.66 0.35 0.85 0.12 0.31 0.52 0.31 0.48 0.19 ...
 $ Liquidez Corr               : num  0.9 1.34 2.65 1.63 3.03 1.65 2.5 2.82 2.16 5.14 ...
 $ LPA                         : num  11.99 3.01 2.35 3.33 3.39 ...
 $ Lucro Líquido_ult_12_meses  : num  1.56e+11 6.63e+09 9.39e+08 3.70e+08 1.17e+09 ...
 $ Lucro Líquido_ult_3_meses   : num  2.88e+10 2.64e+09 2.79e+08 1.01e+08 2.20e+08 ...
 $ Nro. Ações                  : num  1.30e+10 2.20e+09 4.00e+08 1.11e+08 1.03e+09 ...
 $ P/Ativ Circ Liq             : num  -0.96 -1.61 30.19 45.56 -1.42 ...
 $ P/Ativos                    : num  0.47 0.51 0.46 1.19 0.64 0.24 0.78 0.49 0.4 0.6 ...
 $ P/Cap. Giro                 : num  -31.33 8.18 1.42 6.05 5.02 ...
 $ P/EBIT                      : num  1.77 3.53 10.2 13.24 8.18 ...
 $ P/L                         : num  2.96 4.21 8.32 17.46 10.37 ...
 $ P/VP                        : num  1.25 1.18 1.04 2.32 1.81 1.81 1.14 1.65 0.58 0.74 ...
 $ Patrim. Líq                 : num  3.71e+11 2.36e+10 7.52e+09 2.78e+09 6.69e+09 ...
 $ PSR                         : num  0.8 0.78 1.34 1.4 5.16 0.77 1.51 1.57 0.84 3.14 ...
 $ Receita Líquida_ult_12_meses: num  5.82e+11 3.59e+10 5.85e+09 4.61e+09 2.34e+09 ...
 $ Receita Líquida_ult_3_meses : num  1.14e+11 8.82e+09 1.63e+09 1.13e+09 6.79e+08 ...
 $ Valor da firma              : num  6.82e+11 3.60e+10 9.77e+09 6.80e+09 2.02e+10 ...
 $ Valor de mercado            : num  4.63e+11 2.79e+10 7.81e+09 6.46e+09 1.21e+10 ...
 $ VPA                         : num  28.4 10.7 18.8 25.1 19.4 ...</code></pre>
</div>
</div>
</section>
</section>
<section id="dados-percentuais" class="level3">
<h3 class="anchored" data-anchor-id="dados-percentuais">3. Dados percentuais</h3>
<p>Vamos passar logo abaixo as colunas com os valores percentuais de nossa base de dados (?? colunas).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vetor de nomes de colunas </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>colunas_percent <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cres. Rec (5a)"</span>, <span class="st">"Div. Yield"</span>, <span class="st">"EBIT / Ativo"</span>, <span class="st">"Marg. Bruta"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Marg. EBIT"</span>, <span class="st">"Marg. Líquida"</span>, <span class="st">"ROE"</span>, <span class="st">"ROIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com as colunas referenciadas, vamos pedir suporte ao ChatGPT alterando apenas os dados dos valores percentuais de nossa base.</p>
<p>Lembrando que manteremos os valores no formato percentual, tirando o sinal de <code>%</code> dos valores e alterando as colunas para exibirem ao seu final a expressão <code>(%)</code></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que trate as colunas do data.frame “dados_completos” passadas pela variável “colunas_percent” que está no formato de chr para float lendo todas essas colunas e fazendo a alteração por meio de um laço for.</p>
<p>Lembre-se de inicialmente trocar onde tiver “%” por “” e “,” por “.”. Além disso, renomeie todas as colunas do data.frame dadas em “colunas_percent” adicionando ” (%)“.</p>
</div>
</div>
<section id="código-13" class="level4">
<h4 class="anchored" data-anchor-id="código-13">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Substitua "%" por "" e "," por "." e converta para float (numérico)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (coluna <span class="cf">in</span> colunas_percent) {</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Troque "%" por vazio e "," por "."</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  dados_completos[, coluna] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>, <span class="st">"."</span>, </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">gsub</span>(<span class="st">"%"</span>, <span class="st">""</span>, </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>                                                    dados_completos[, coluna])))</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Renomeie a coluna adicionando "(%)"</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(dados_completos)[<span class="fu">colnames</span>(dados_completos) <span class="sc">==</span> coluna] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(coluna, </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="st">" (%)"</span>)</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos testar se a conversão foi bem sucedida de acordo com código que geramos com o ChatGPT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testando se a conversão foi bem sucedida (lendo quantas colunas não são numéricas)</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dados_completos <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.character))[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lendo a estrutura das 5 primeiras colunas</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dados_completos[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   40 obs. of  5 variables:
 $ Ação              : chr  "PETR4" "CMIG4" "CYRE3" "ARZZ3" ...
 $ Ativo             : num  9.90e+11 5.45e+10 1.68e+10 5.44e+09 1.88e+10 ...
 $ Ativo Circulante  : num  1.37e+11 1.35e+10 8.84e+09 2.77e+09 3.60e+09 ...
 $ Cres. Rec (5a) (%): num  19.4 11.8 12.2 35.7 9.3 39.8 2 20 78.2 16.3 ...
 $ Disponibilidades  : num  6.10e+10 3.73e+09 2.88e+09 6.82e+08 1.32e+09 ...</code></pre>
</div>
</div>
<p>Pronto! Agora nossa tabela está pronta para ser utilizada com os valores em seus devidos tipos. Vamos realizar alguns testes antes de salvá-la no formato <code>CSV</code>, que tem uma estrutura simples e é facilmente utilizado por diversos softwares de BI e de análise de dados.</p>
</section>
</section>
</section>
<section id="testando-a-tabela" class="level2">
<h2 class="anchored" data-anchor-id="testando-a-tabela">Testando a tabela</h2>
<p>Nesta etapa, vamos realizar alguns testes em nossa tabela, utilizando filtros, agrupando e visualizando os dados para verificar se ela está apta para uso pelo time de consultoria.</p>
<section id="teste-1---filtrando-pelo-setor" class="level3">
<h3 class="anchored" data-anchor-id="teste-1---filtrando-pelo-setor">Teste 1 - Filtrando pelo setor</h3>
<p>Vamos inicialmente ler os diferentes setores que possuem em nossa base de dados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quais setores aparecem na base de dados</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dados_completos<span class="sc">$</span>Setor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Petróleo, Gás e Biocombustíveis"         
 [2] "Energia Elétrica"                        
 [3] "Construção Civil"                        
 [4] "Comércio"                                
 [5] "Tecidos, Vestuário e Calçados"           
 [6] "Madeira e Papel"                         
 [7] "Transporte"                              
 [8] "Químicos"                                
 [9] "Diversos"                                
[10] "Siderurgia e Metalurgia"                 
[11] "Serviços Financeiros Diversos"           
[12] "Viagens e Lazer"                         
[13] "Mineração"                               
[14] "Telecomunicações"                        
[15] "Comércio e Distribuição"                 
[16] "Alimentos Processados"                   
[17] "Serv.Méd.Hospit. Análises e Diagnósticos"</code></pre>
</div>
</div>
<p>Para filtrarmos por setor é interessante também observar a quantidade de repetições desses setores em nossa base de dados. Vamos utilizar o ChatGPT aqui?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que crie um tabela com os dados da coluna “Setor” do data.frame “dados_completos e passe o resultado para a variável”freq_setor”. Em seguida, crie uma variável “freq_setor_ord” que recebe a tabela “freq_setor” como data.frame ordenando os dados de maneira decrescente pela coluna “Freq”. Por fim, exiba a variável “freq_setor_ord”.</p>
</div>
</div>
<section id="código-14" class="level4">
<h4 class="anchored" data-anchor-id="código-14">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar tabela de frequência para a coluna "Setor"</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>freq_setor <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Setor) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Freq =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar variável ordenada</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>freq_setor_ord <span class="ot">&lt;-</span> freq_setor <span class="sc">%&gt;%</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Freq))         </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Exibindo a tabela</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(freq_setor_ord)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Setor</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Energia Elétrica</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Petróleo, Gás e Biocombustíveis</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Comércio</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Construção Civil</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Siderurgia e Metalurgia</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transporte</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diversos</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Madeira e Papel</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Serviços Financeiros Diversos</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Telecomunicações</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alimentos Processados</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Comércio e Distribuição</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mineração</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Químicos</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Serv.Méd.Hospit. Análises e Diagnósticos</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tecidos, Vestuário e Calçados</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Viagens e Lazer</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Podemos notar que o setor de <strong>Energia Elétrica</strong> possui o maior número de ativos selecionados. Vamos usar o ChatGPT para filtrar os dados por este setor, ordenado pelo nome do ativo.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que filtre o dataframe “dados_completos” que possuem “Energia Elétrica” na coluna “Setor” e ordene os dados em ordem alfabética pela coluna “Ação”.</p>
</div>
</div>
</section>
<section id="código-15" class="level4">
<h4 class="anchored" data-anchor-id="código-15">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtre e ordene os dados</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>setor_eletrico <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Setor <span class="sc">==</span> <span class="st">"Energia Elétrica"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Ação)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>setor_eletrico</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Ação       Ativo Ativo Circulante Cres. Rec (5a) (%) Disponibilidades
1  CMIG4 5.45431e+10      13540400000               11.8       3725800000
2  CPFE3 7.24450e+10      16629000000               10.1       5275610000
3  CPLE6 5.40071e+10      11108500000               10.8       4447800000
4  EGIE3 3.93974e+10       6324340000                3.9       3085250000
5  ELET3 2.63464e+11      43749200000               17.1      20193500000
6  ELET6 2.63464e+11      43749200000               17.1      20193500000
7  ENEV3 4.27907e+10       5326810000               29.9       1686680000
8 TAEE11 1.88123e+10       3598340000                9.3       1323640000
  Div Br/ Patrim  Dív. Bruta Dív. Líquida Div. Yield (%) EBIT / Ativo (%)
1           0.50 11831000000   8105240000            8.7             14.5
2           1.38 24673100000  19397500000            8.3             14.6
3           0.75 16307700000  11859900000            7.6              6.9
4           2.12 17855700000  14770400000            8.7             14.0
5           0.51 57369400000  37175900000            0.6              3.3
6           0.51 57369400000  37175900000            3.7              3.3
7           1.41 18263000000  16576300000            0.0              4.6
8           1.41  9426130000   8102490000            9.6              7.9
  EBIT_ult_12_meses EBIT_ult_3_meses EV / EBIT EV / EBITDA Giro Ativos
1        7899710000       1828940000      4.56        3.95        0.66
2       10589900000       2536300000      5.63        4.79        0.55
3        3738590000        774783000     10.23        7.48        0.41
4        5521680000       1216800000      8.72        7.47        0.28
5        8704280000       4993900000     14.10       10.07        0.13
6        8704280000       4993900000     15.08       10.76        0.13
7        1968290000        753713000     17.61       10.42        0.21
8        1479750000        387548000     13.66       13.47        0.12
  Liquidez Corr  LPA Lucro Líquido_ult_12_meses Lucro Líquido_ult_3_meses
1          1.34 3.01                 6627360000                2642220000
2          0.91 4.80                 5527900000                1188890000
3          1.47 0.65                 1928570000                 317792000
4          1.09 4.13                 3371920000                 867279000
5          1.47 0.74                 1703340000                1685230000
6          1.47 0.74                 1703340000                1685230000
7          1.14 0.41                  656461000                 389928000
8          3.03 3.39                 1167790000                 220426000
  Marg. Bruta (%) Marg. EBIT (%) Marg. Líquida (%) Nro. Ações P/Ativ Circ Liq
1            23.8           22.0              18.5 2201370000           -1.61
2            32.3           26.5              14.2 1152250000           -1.09
3            21.6           17.0               8.9 2982810000           -1.26
4            53.4           49.6              30.3  815928000           -1.41
5            49.6           25.2               4.5 2307100000           -0.79
6            49.6           25.2               4.5 2307100000           -0.87
7            34.7           21.9               7.3 1584450000           -0.82
8            70.9           63.1              49.8 1033500000           -1.42
  P/Ativos P/Cap. Giro P/EBIT   P/L P/VP Patrim. Líq  PSR
1     0.51        8.18   3.53  4.21 1.18 2.36091e+10 0.78
2     0.56      -25.30   3.80  7.28 2.26 1.78314e+10 1.01
3     0.49        7.45   7.05 13.67 1.21 2.17608e+10 1.20
4     0.85       64.52   6.04  9.89 3.95 8.43683e+09 2.99
5     0.32        6.15   9.83 50.24 0.77 1.11402e+11 2.48
6     0.36        6.76  10.81 55.22 0.84 1.11402e+11 2.73
7     0.42       28.16   9.19 27.56 1.40 1.29651e+10 2.01
8     0.64        5.02   8.18 10.37 1.81 6.68930e+09 5.16
  Receita Líquida_ult_12_meses Receita Líquida_ult_3_meses ROE (%) ROIC (%)
1                  35868400000                  8819520000    28.1     16.3
2                  39970600000                  9388920000    31.0     16.5
3                  21971800000                  5359730000     8.9      7.9
4                  11138200000                  2513510000    40.0     15.5
5                  34492200000                  9245530000     1.5      3.6
6                  34492200000                  9245530000     1.5      3.6
7                   9003490000                  2523330000     5.1      5.0
8                   2344570000                   678504000    17.5      8.5
             Setor         Subsetor Valor da firma Valor de mercado   VPA
1 Energia Elétrica Energia Elétrica    3.60186e+10      27913400000 10.72
2 Energia Elétrica Energia Elétrica    5.96457e+10      40248300000 15.48
3 Energia Elétrica Energia Elétrica    3.82280e+10      26368000000  7.30
4 Energia Elétrica Energia Elétrica    4.81255e+10      33355100000 10.34
5 Energia Elétrica Energia Elétrica    1.22746e+11      85570300000 48.29
6 Energia Elétrica Energia Elétrica    1.31236e+11      94060500000 48.29
7 Energia Elétrica Energia Elétrica    3.46707e+10      18094400000  8.18
8 Energia Elétrica Energia Elétrica    2.02082e+10      12105700000 19.42</code></pre>
</div>
</div>
<p>Conseguimos filtrar de maneira simples e direta todos os ativos cujo setor seja de “Energia Elétrica”. Vamos partir para o filtro levando em conta os valores de um dos indicadores.</p>
</section>
</section>
<section id="teste-2---filtrando-por-valor-de-indicador" class="level3">
<h3 class="anchored" data-anchor-id="teste-2---filtrando-por-valor-de-indicador">Teste 2 - Filtrando por valor de indicador</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que selecione apenas as colunas “Ação” e “Div. Yield (%)” do dataframe “dados_completos” e que filtre os dados para valores de “Div. Yield (%)” acima de 8, escolhendo entre eles os 5 ativos com os maiores valores de “Div. Yield (%)”.</p>
</div>
</div>
<section id="código-16" class="level4">
<h4 class="anchored" data-anchor-id="código-16">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>maiores_DY <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ação, <span class="st">`</span><span class="at">Div. Yield (%)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Div. Yield (%)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>, <span class="at">wt =</span> <span class="st">`</span><span class="at">Div. Yield (%)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>O ChatGPT pode trazer aqui duas funções que executam a mesma ação: <code>slice_max</code> ou <code>top_n</code>.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>maiores_DY</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Ação Div. Yield (%)
1  PETR4           26.1
2 TAEE11            9.6
3  GGBR4           14.0
4  GOAU4           10.7
5  JBSS3            9.4</code></pre>
</div>
</div>
<p>Conseguimos filtrar os ativos com DY (Dividend Yield) acima de 8%, escolhendo também quais colunas queremos selecionar para representar. Algo que poderia ser feito aqui é gerar uma visualização que apresente os maiores DY ou realizar uma seleção customizada de ativos.</p>
<p>Vamos partir para mais um filtro, gerando um novo dataframe com uma nova coluna baseada em valores do dataframe original (dados_completos)</p>
</section>
</section>
<section id="teste-3---filtrando-por-1-ou-mais-indicadores" class="level3">
<h3 class="anchored" data-anchor-id="teste-3---filtrando-por-1-ou-mais-indicadores">Teste 3 - Filtrando por 1 ou mais indicadores</h3>
<p>Agora, vamos criar um dataframe <code>carteira_cliente</code> que recebe apenas os ativos que possuem P/L (Preço sobre Lucro) menor ou igual a 1.5 e P/VP (Preço pelo Valor Patrimonial) menor ou igual a 15. E além disso, vamos gerar uma coluna chamada <strong>Valor Intrínseco</strong> que é dada pela seguinte fórmula:</p>
<p><span class="math inline">\(Valor Intrínseco = \sqrt(22.5 * LPA * VPA)\)</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que crie um data.frame chamado “carteira_cliente” que selecione apenas as colunas “Ação”, “P/L”, “P/VP”, “LPA” e “VPA” do data.frame “dados_completos”. Filtre os dados para valores de “P/L” menor ou igual a 15 e “P/VP” menor ou igual a 1.5 e valores de “VPA” e “LPA” acima de 0. E, além disso, gere uma coluna em “carteira_cliente” chamada “Valor Intrínseco” que é dada pela seguinte fórmula : raiz quadradada do produto entre 22.5, “LPA” e “VPA”.</p>
</div>
</div>
<section id="código-17" class="level4">
<h4 class="anchored" data-anchor-id="código-17">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crie o data.frame "carteira_cliente" com as condições e a coluna "Valor Intrínseco"</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>carteira_cliente <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ação, <span class="st">"P/L"</span>, <span class="st">"P/VP"</span>, LPA, VPA) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">P/L</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">15</span>, <span class="st">`</span><span class="at">P/VP</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="fl">1.5</span>, VPA <span class="sc">&gt;</span> <span class="dv">0</span>, LPA <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Valor Intrínseco</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fl">22.5</span> <span class="sc">*</span> LPA <span class="sc">*</span> VPA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(carteira_cliente)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Ação</th>
<th style="text-align: right;">P/L</th>
<th style="text-align: right;">P/VP</th>
<th style="text-align: right;">LPA</th>
<th style="text-align: right;">VPA</th>
<th style="text-align: right;">Valor Intrínseco</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PETR4</td>
<td style="text-align: right;">2.96</td>
<td style="text-align: right;">1.25</td>
<td style="text-align: right;">11.99</td>
<td style="text-align: right;">28.42</td>
<td style="text-align: right;">87.561438</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMIG4</td>
<td style="text-align: right;">4.21</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">3.01</td>
<td style="text-align: right;">10.72</td>
<td style="text-align: right;">26.944610</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CYRE3</td>
<td style="text-align: right;">8.32</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">18.81</td>
<td style="text-align: right;">31.536943</td>
</tr>
<tr class="even">
<td style="text-align: left;">SOMA3</td>
<td style="text-align: right;">14.08</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">9.61</td>
<td style="text-align: right;">9.183014</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EZTC3</td>
<td style="text-align: right;">13.37</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">1.15</td>
<td style="text-align: right;">20.71</td>
<td style="text-align: right;">23.148893</td>
</tr>
<tr class="even">
<td style="text-align: left;">RECV3</td>
<td style="text-align: right;">5.98</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">3.40</td>
<td style="text-align: right;">14.71</td>
<td style="text-align: right;">33.545715</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CPLE6</td>
<td style="text-align: right;">13.67</td>
<td style="text-align: right;">1.21</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">7.30</td>
<td style="text-align: right;">10.332594</td>
</tr>
<tr class="even">
<td style="text-align: left;">CIEL3</td>
<td style="text-align: right;">4.74</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">4.41</td>
<td style="text-align: right;">8.740895</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GGBR4</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">4.63</td>
<td style="text-align: right;">28.80</td>
<td style="text-align: right;">54.774447</td>
</tr>
<tr class="even">
<td style="text-align: left;">GOAU4</td>
<td style="text-align: right;">4.10</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">2.65</td>
<td style="text-align: right;">17.36</td>
<td style="text-align: right;">32.172815</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JBSS3</td>
<td style="text-align: right;">10.18</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">2.10</td>
<td style="text-align: right;">19.10</td>
<td style="text-align: right;">30.041222</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Conseguimos com sucesso gerar um novo data.frame filtrando as colunas desejadas e criando uma nova coluna por meio do cálculo das colunas que formatamos para dados numéricos. Para finalizar nossos testes vamos pedir o suporte ao chatGPT para gerar uma visualização com os dados da tabela.</p>
</section>
</section>
<section id="teste-4---visualização-de-dados" class="level3">
<h3 class="anchored" data-anchor-id="teste-4---visualização-de-dados">Teste 4 - Visualização de dados</h3>
<p>Para testar também a visualização dos dados, vamos gerar um gráfico de cascata com o Balanço Patrimonial dos Ativos da <strong>PRIO3</strong>. Para isso, inicialmente vamos criar um df só com os dados desse ativo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>prio <span class="ot">&lt;-</span> dados_completos <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Ação <span class="sc">==</span> <span class="st">"PRIO3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para que a gente consiga gerar esse gráfico de cascata, primeiramente precisamos calcular o valor do <strong>Ativo Não Circulante</strong> que é a diferenção entre <strong>Ativo</strong> e <strong>Ativo Circulante</strong>. Vamos fazer esse processo com o suporte do ChatGPT.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que crie um gráfico de cascata pelo plotly passando para um objeto “fig” que apresente três valores do dataframe “prio”: os valores “Ativo”, “Ativo Circulante” e “Ativo Não Circulante”.</p>
<p>Neste gráfico, para “measure” passe “absolute” para “Ativo”, “relative” para o valor negativo de “Ativo Circulante” e “total” para o “Ativo Não Circulante”. Para variável “x”, passe o vetor do nome de cada coluna, por exemplo, <code>x=c("Ativo",...)</code> e para variável name, passe “Ativo”.</p>
<p>Ajuste o layout para apresentar os incrementos, eliminar a legenda e colocar como Título “Balanço Patrimonial dos Ativos (PRIO3)”.</p>
</div>
</div>
<section id="código-18" class="level4">
<h4 class="anchored" data-anchor-id="código-18">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponha que você já tenha o dataframe "prio" e o pacote "plotly" instalado</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("plotly")</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'plotly' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>prio<span class="sc">$</span><span class="st">`</span><span class="at">Ativo Não Circulante</span><span class="st">`</span> <span class="ot">&lt;-</span> prio<span class="sc">$</span>Ativo <span class="sc">-</span> prio<span class="sc">$</span><span class="st">`</span><span class="at">Ativo Circulante</span><span class="st">`</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar um objeto de figura plotly</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> prio,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Ativo"</span>, <span class="st">"Ativo Circulante"</span>, <span class="st">"Ativo Não Circulante"</span>),</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(prio<span class="sc">$</span><span class="st">`</span><span class="at">Ativo</span><span class="st">`</span>, <span class="sc">-</span>prio<span class="sc">$</span><span class="st">`</span><span class="at">Ativo Circulante</span><span class="st">`</span>, prio<span class="sc">$</span><span class="st">`</span><span class="at">Ativo Não Circulante</span><span class="st">`</span>),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Ativo"</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"waterfall"</span>,</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">measure =</span> <span class="fu">c</span>(<span class="st">"absolute"</span>, <span class="st">"relative"</span>, <span class="st">"total"</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar o layout</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Balanço Patrimonial dos Ativos (PRIO3)"</span>,</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">FALSE</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Exibir o gráfico</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-03e1f7b162d7d6b0f499" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-03e1f7b162d7d6b0f499">{"x":{"visdat":{"5b0016534f60":["function () ","plotlyVisDat"]},"cur_data":"5b0016534f60","attrs":{"5b0016534f60":{"x":["Ativo","Ativo Circulante","Ativo Não Circulante"],"y":[28521700000,-5086530000,23435170000],"measure":["absolute","relative","total"],"name":"Ativo","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"waterfall"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Balanço Patrimonial dos Ativos (PRIO3)","showlegend":false,"xaxis":{"domain":[0,1],"automargin":true,"title":[],"type":"category","categoryorder":"array","categoryarray":["Ativo","Ativo Circulante","Ativo Não Circulante"]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["Ativo","Ativo Circulante","Ativo Não Circulante"],"y":[28521700000,-5086530000,23435170000],"measure":["absolute","relative","total"],"name":"Ativo","type":"waterfall","xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Pronto! Conseguimos gerar o gráfico desejado e testar a nossa base em diversas situações. Agora que sabemos que ela está pronta para o uso vamos partir para a última etapa desse projeto que é salvar a nossa tabela em diversos formatos para uso.</p>
</section>
</section>
</section>
<section id="salvando-a-tabela" class="level2">
<h2 class="anchored" data-anchor-id="salvando-a-tabela">Salvando a tabela</h2>
<p>Nesta etapa, vamos salvar a nossa tabela com os <code>dados_completos</code> e, para isso, vamos pedir mais uma vez para o chatGPT como salvá-la em três tipos diferentes:</p>
<ul>
<li><p>CSV</p></li>
<li><p>JSON</p></li>
<li><p>XLSX</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prompt
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gere um código em R que salve o data.frame “dados_completos em três formatos diferentes: csv, json e xlsx. Em todos os formatos nomeie o arquivo salvo como”dados_ibov_bulltrend” seguido da extensão do arquivo.</p>
</div>
</div>
<section id="código-19" class="level4">
<h4 class="anchored" data-anchor-id="código-19">Código</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Salvar em formato CSV</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(dados_completos, <span class="st">"dados_ibov_bulltrend.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Salvar em formato JSON</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_json</span>(dados_completos, <span class="st">"dados_ibov_bulltrend.json"</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Salvar em formato XLSX</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(dados_completos, <span class="st">"dados_ibov_bulltrend.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="referências" class="level2">
<h2 class="anchored" data-anchor-id="referências">Referências</h2>
<ul>
<li><p>Documentação do tidyverse (em inglês). Disponível em: <a href="https://tidyverse.tidyverse.org/" class="uri">https://tidyverse.tidyverse.org/</a></p></li>
<li><p>Documentação do jsonlite (em inglês). Disponível em: <a href="https://jeroen.r-universe.dev/jsonlite/jsonlite.pdf" class="uri">https://jeroen.r-universe.dev/jsonlite/jsonlite.pdf</a></p></li>
<li><p>Documentação do plolty (em inglês).Disponível em: <a href="https://plotly.com/r/" class="uri">https://plotly.com/r/</a></p></li>
<li><p>Documentação do openxlsx (em inglês). Disponível em: <a href="https://cran.r-project.org/web/packages/openxlsx/openxlsx.pdf" class="uri">https://cran.r-project.org/web/packages/openxlsx/openxlsx.pdf</a></p></li>
<li><p>R for Data Science (2e) (em inglês). Disponível em: <a href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz</a></p></li>
<li><p>RDRR.io - Site compilando as documentações de pacotes do R (CRAN, GitHub, R-forge…). Disponível em: <a href="https://rdrr.io/" class="uri">https://rdrr.io/</a></p></li>
<li><p>Índice Bovespa (Ibovespa B3). Disponível em: <a href="https://www.b3.com.br/pt_br/market-data-e-indices/indices/indices-amplos/indice-ibovespa-ibovespa-composicao-da-carteira.htm" class="uri">https://www.b3.com.br/pt_br/market-data-e-indices/indices/indices-amplos/indice-ibovespa-ibovespa-composicao-da-carteira.htm</a></p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>